{"version":3,"file":"index.js","names":["dequal","wordBoundariesRegex","qs","React","useCallback","useEffect","useMemo","useReducer","useRef","useState","AddNewRelation","useDocumentDrawer","useListDrawer","ReactSelect","RenderCustomComponent","FieldDescription","FieldError","FieldLabel","useField","withCondition","useDebouncedCallback","useEffectEvent","useAuth","useConfig","useLocale","useTranslation","mergeFieldStyles","fieldBaseClass","createRelationMap","findOptionsByValue","optionsReducer","MultiValueLabel","SingleValue","maxResultsPerRequest","baseClass","RelationshipFieldComponent","props","field","admin","allowCreate","allowEdit","appearance","className","description","isSortable","sortOptions","hasMany","label","localized","relationTo","required","path","pathFromProps","readOnly","validate","config","getEntityConfig","routes","api","serverURL","i18n","t","permissions","code","locale","hasMultipleRelations","Array","isArray","currentlyOpenRelationship","setCurrentlyOpenRelationship","id","undefined","collectionSlug","hasReadPermission","lastFullyLoadedRelation","setLastFullyLoadedRelation","lastLoadedPage","setLastLoadedPage","errorLoading","setErrorLoading","search","setSearch","isLoading","setIsLoading","enableWordBoundarySearch","setEnableWordBoundarySearch","menuIsOpen","setMenuIsOpen","hasLoadedFirstPageRef","memoizedValidate","value","validationOptions","customComponents","AfterInput","BeforeInput","Description","Error","Label","disabled","filterOptions","initialValue","setValue","showError","potentiallyStalePath","options","dispatchOptions","valueRef","current","DocumentDrawer","isDrawerOpen","openDrawer","listDrawerFilterOptions","newFilterOptions","forEach","val","not_in","ListDrawer","closeDrawer","closeListDrawer","isListDrawerOpen","openListDrawer","collectionSlugs","onListSelect","doc","formattedSelection","withSelection","push","openDrawerWhenRelationChanges","getResults","lastFullyLoadedRelationArg","lastLoadedPageArg","onSuccess","searchArg","sort","valueArg","lastFullyLoadedRelationToUse","relations","relationsToFetch","slice","resultsFetched","relationMap","reduce","priorRelation","relation","relationFilterOption","lastLoadedPageToUse","indexOf","Promise","resolve","collection","fieldToSearch","useAsTitle","fieldToSort","defaultSort","query","depth","draft","limit","page","where","and","like","response","fetch","body","stringify","credentials","headers","language","method","ok","data","json","prevState","nextPage","docs","length","type","status","ids","updateSearch","handleInputChange","handleValueChange","Object","entries","idsToLoad","filter","find","optionGroup","option","in","prevValue","isFirstRenderRef","isIdOnly","idOnly","getResultsEffectEvent","args","exemptValues","onSave","collectionConfig","currentValue","docID","unchanged","some","valuesToSet","map","slug","onDuplicate","concat","onDelete","filterOption","item","searchFilter","r","breakApartThreshold","labelString","String","indexOfSpace","test","onDocumentDrawerOpen","valueToRender","styles","_jsxs","Boolean","join","replace","style","_jsx","CustomComponent","Fallback","backspaceRemovesValue","components","DropdownIndicator","customProps","disableKeyDown","disableMouseDown","getOptionValue","isMulti","isSearchable","onChange","selected","onInputChange","newSearch","onMenuClose","onMenuOpen","onMenuScrollToBottom","enableRowSelections","onSelect","RelationshipField"],"sources":["../../../src/fields/Relationship/index.tsx"],"sourcesContent":["'use client'\nimport type {\n  FilterOptionsResult,\n  PaginatedDocs,\n  RelationshipFieldClientComponent,\n  Where,\n} from 'payload'\n\nimport { dequal } from 'dequal/lite'\nimport { wordBoundariesRegex } from 'payload/shared'\nimport * as qs from 'qs-esm'\nimport React, { useCallback, useEffect, useMemo, useReducer, useRef, useState } from 'react'\n\nimport type { DocumentDrawerProps } from '../../elements/DocumentDrawer/types.js'\nimport type { ListDrawerProps } from '../../elements/ListDrawer/types.js'\nimport type { ReactSelectAdapterProps } from '../../elements/ReactSelect/types.js'\nimport type { GetResults, Option, Value } from './types.js'\n\nimport { AddNewRelation } from '../../elements/AddNewRelation/index.js'\nimport { useDocumentDrawer } from '../../elements/DocumentDrawer/index.js'\nimport { useListDrawer } from '../../elements/ListDrawer/index.js'\nimport { ReactSelect } from '../../elements/ReactSelect/index.js'\nimport { RenderCustomComponent } from '../../elements/RenderCustomComponent/index.js'\nimport { FieldDescription } from '../../fields/FieldDescription/index.js'\nimport { FieldError } from '../../fields/FieldError/index.js'\nimport { FieldLabel } from '../../fields/FieldLabel/index.js'\nimport { useField } from '../../forms/useField/index.js'\nimport { withCondition } from '../../forms/withCondition/index.js'\nimport { useDebouncedCallback } from '../../hooks/useDebouncedCallback.js'\nimport { useEffectEvent } from '../../hooks/useEffectEvent.js'\nimport { useAuth } from '../../providers/Auth/index.js'\nimport { useConfig } from '../../providers/Config/index.js'\nimport { useLocale } from '../../providers/Locale/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport './index.scss'\nimport { mergeFieldStyles } from '../mergeFieldStyles.js'\nimport { fieldBaseClass } from '../shared/index.js'\nimport { createRelationMap } from './createRelationMap.js'\nimport { findOptionsByValue } from './findOptionsByValue.js'\nimport { optionsReducer } from './optionsReducer.js'\nimport { MultiValueLabel } from './select-components/MultiValueLabel/index.js'\nimport { SingleValue } from './select-components/SingleValue/index.js'\n\nconst maxResultsPerRequest = 10\n\nconst baseClass = 'relationship'\n\nconst RelationshipFieldComponent: RelationshipFieldClientComponent = (props) => {\n  const {\n    field,\n    field: {\n      admin: {\n        allowCreate = true,\n        allowEdit = true,\n        appearance = 'select',\n        className,\n        description,\n        isSortable = true,\n        sortOptions,\n      } = {},\n      hasMany,\n      label,\n      localized,\n      relationTo,\n      required,\n    },\n    path: pathFromProps,\n    readOnly,\n    validate,\n  } = props\n\n  const { config, getEntityConfig } = useConfig()\n\n  const {\n    routes: { api },\n    serverURL,\n  } = config\n\n  const { i18n, t } = useTranslation()\n  const { permissions } = useAuth()\n  const { code: locale } = useLocale()\n  const hasMultipleRelations = Array.isArray(relationTo)\n\n  const [currentlyOpenRelationship, setCurrentlyOpenRelationship] = useState<\n    Parameters<ReactSelectAdapterProps['customProps']['onDocumentDrawerOpen']>[0]\n  >({\n    id: undefined,\n    collectionSlug: undefined,\n    hasReadPermission: false,\n  })\n\n  const [lastFullyLoadedRelation, setLastFullyLoadedRelation] = useState(-1)\n  const [lastLoadedPage, setLastLoadedPage] = useState<Record<string, number>>({})\n  const [errorLoading, setErrorLoading] = useState('')\n  const [search, setSearch] = useState('')\n  const [isLoading, setIsLoading] = useState(false)\n  const [enableWordBoundarySearch, setEnableWordBoundarySearch] = useState(false)\n  const [menuIsOpen, setMenuIsOpen] = useState(false)\n  const hasLoadedFirstPageRef = useRef(false)\n\n  const memoizedValidate = useCallback(\n    (value, validationOptions) => {\n      if (typeof validate === 'function') {\n        return validate(value, { ...validationOptions, required })\n      }\n    },\n    [validate, required],\n  )\n\n  const {\n    customComponents: { AfterInput, BeforeInput, Description, Error, Label } = {},\n    disabled,\n    filterOptions,\n    initialValue,\n    path,\n    setValue,\n    showError,\n    value,\n  } = useField<Value | Value[]>({\n    potentiallyStalePath: pathFromProps,\n    validate: memoizedValidate,\n  })\n\n  const [options, dispatchOptions] = useReducer(optionsReducer, [])\n\n  const valueRef = useRef(value)\n  valueRef.current = value\n\n  const [DocumentDrawer, , { isDrawerOpen, openDrawer }] = useDocumentDrawer({\n    id: currentlyOpenRelationship.id,\n    collectionSlug: currentlyOpenRelationship.collectionSlug,\n  })\n\n  // Filter selected values from displaying in the list drawer\n  const listDrawerFilterOptions = useMemo<FilterOptionsResult>(() => {\n    let newFilterOptions = filterOptions\n\n    if (value) {\n      ;(Array.isArray(value) ? value : [value]).forEach((val) => {\n        ;(Array.isArray(relationTo) ? relationTo : [relationTo]).forEach((relationTo) => {\n          newFilterOptions = {\n            ...(filterOptions || {}),\n            [relationTo]: {\n              ...(typeof filterOptions?.[relationTo] === 'object' ? filterOptions[relationTo] : {}),\n              id: {\n                not_in: [typeof val === 'object' ? val.value : val],\n              },\n            },\n          }\n        })\n      })\n    }\n\n    return newFilterOptions\n  }, [filterOptions, value, relationTo])\n\n  const [\n    ListDrawer,\n    ,\n    { closeDrawer: closeListDrawer, isDrawerOpen: isListDrawerOpen, openDrawer: openListDrawer },\n  ] = useListDrawer({\n    collectionSlugs: hasMultipleRelations ? relationTo : [relationTo],\n    filterOptions: listDrawerFilterOptions,\n  })\n\n  const onListSelect = useCallback<NonNullable<ListDrawerProps['onSelect']>>(\n    ({ collectionSlug, doc }) => {\n      const formattedSelection = hasMultipleRelations\n        ? {\n            relationTo: collectionSlug,\n            value: doc.id,\n          }\n        : doc.id\n\n      if (hasMany) {\n        const withSelection = Array.isArray(value) ? value : []\n        withSelection.push(formattedSelection)\n        setValue(withSelection)\n      } else {\n        setValue(formattedSelection)\n      }\n\n      closeListDrawer()\n    },\n    [hasMany, hasMultipleRelations, setValue, closeListDrawer, value],\n  )\n\n  const openDrawerWhenRelationChanges = useRef(false)\n\n  const getResults: GetResults = useCallback(\n    async ({\n      filterOptions,\n      lastFullyLoadedRelation: lastFullyLoadedRelationArg,\n      lastLoadedPage: lastLoadedPageArg,\n      onSuccess,\n      search: searchArg,\n      sort,\n      value: valueArg,\n    }) => {\n      if (!permissions) {\n        return\n      }\n      const lastFullyLoadedRelationToUse =\n        typeof lastFullyLoadedRelationArg !== 'undefined' ? lastFullyLoadedRelationArg : -1\n\n      const relations = Array.isArray(relationTo) ? relationTo : [relationTo]\n      const relationsToFetch =\n        lastFullyLoadedRelationToUse === -1\n          ? relations\n          : relations.slice(lastFullyLoadedRelationToUse + 1)\n\n      let resultsFetched = 0\n      const relationMap = createRelationMap({\n        hasMany,\n        relationTo,\n        value: valueArg,\n      })\n\n      if (!errorLoading) {\n        await relationsToFetch.reduce(async (priorRelation, relation) => {\n          const relationFilterOption = filterOptions?.[relation]\n\n          let lastLoadedPageToUse\n          if (search !== searchArg) {\n            lastLoadedPageToUse = 1\n          } else {\n            lastLoadedPageToUse = lastLoadedPageArg[relation] + 1\n          }\n          await priorRelation\n\n          if (relationFilterOption === false) {\n            setLastFullyLoadedRelation(relations.indexOf(relation))\n            return Promise.resolve()\n          }\n\n          if (resultsFetched < 10) {\n            const collection = getEntityConfig({ collectionSlug: relation })\n            const fieldToSearch = collection?.admin?.useAsTitle || 'id'\n            let fieldToSort = collection?.defaultSort || 'id'\n            if (typeof sortOptions === 'string') {\n              fieldToSort = sortOptions\n            } else if (sortOptions?.[relation]) {\n              fieldToSort = sortOptions[relation]\n            }\n\n            const query: {\n              [key: string]: unknown\n              where: Where\n            } = {\n              depth: 0,\n              draft: true,\n              limit: maxResultsPerRequest,\n              locale,\n              page: lastLoadedPageToUse,\n              sort: fieldToSort,\n              where: {\n                and: [\n                  {\n                    id: {\n                      not_in: relationMap[relation],\n                    },\n                  },\n                ],\n              },\n            }\n\n            if (searchArg) {\n              query.where.and.push({\n                [fieldToSearch]: {\n                  like: searchArg,\n                },\n              })\n            }\n\n            if (relationFilterOption && typeof relationFilterOption !== 'boolean') {\n              query.where.and.push(relationFilterOption)\n            }\n\n            const response = await fetch(`${serverURL}${api}/${relation}`, {\n              body: qs.stringify(query),\n              credentials: 'include',\n              headers: {\n                'Accept-Language': i18n.language,\n                'Content-Type': 'application/x-www-form-urlencoded',\n                'X-HTTP-Method-Override': 'GET',\n              },\n              method: 'POST',\n            })\n\n            if (response.ok) {\n              const data: PaginatedDocs<unknown> = await response.json()\n              setLastLoadedPage((prevState) => {\n                return {\n                  ...prevState,\n                  [relation]: lastLoadedPageToUse,\n                }\n              })\n\n              if (!data.nextPage) {\n                setLastFullyLoadedRelation(relations.indexOf(relation))\n              }\n\n              if (data.docs.length > 0) {\n                resultsFetched += data.docs.length\n\n                dispatchOptions({\n                  type: 'ADD',\n                  collection,\n                  config,\n                  docs: data.docs,\n                  i18n,\n                  sort,\n                })\n              }\n            } else if (response.status === 403) {\n              setLastFullyLoadedRelation(relations.indexOf(relation))\n              dispatchOptions({\n                type: 'ADD',\n                collection,\n                config,\n                docs: [],\n                i18n,\n                ids: relationMap[relation],\n                sort,\n              })\n            } else {\n              setErrorLoading(t('error:unspecific'))\n            }\n          }\n        }, Promise.resolve())\n\n        if (typeof onSuccess === 'function') {\n          onSuccess()\n        }\n      }\n    },\n    [\n      permissions,\n      relationTo,\n      hasMany,\n      errorLoading,\n      search,\n      getEntityConfig,\n      locale,\n      serverURL,\n      sortOptions,\n      api,\n      i18n,\n      config,\n      t,\n    ],\n  )\n\n  const updateSearch = useDebouncedCallback((searchArg: string, valueArg: Value | Value[]) => {\n    void getResults({\n      filterOptions,\n      lastLoadedPage: {},\n      search: searchArg,\n      sort: true,\n      value: valueArg,\n    })\n    setSearch(searchArg)\n  }, 300)\n\n  const handleInputChange = useCallback(\n    (searchArg: string, valueArg: Value | Value[]) => {\n      if (search !== searchArg) {\n        setLastLoadedPage({})\n        updateSearch(searchArg, valueArg, searchArg !== '')\n      }\n    },\n    [search, updateSearch],\n  )\n\n  const handleValueChange = useEffectEvent((value: Value | Value[]) => {\n    const relationMap = createRelationMap({\n      hasMany,\n      relationTo,\n      value,\n    })\n\n    void Object.entries(relationMap).reduce(async (priorRelation, [relation, ids]) => {\n      await priorRelation\n\n      const idsToLoad = ids.filter((id) => {\n        return !options.find((optionGroup) =>\n          optionGroup?.options?.find(\n            (option) => option.value === id && option.relationTo === relation,\n          ),\n        )\n      })\n\n      if (idsToLoad.length > 0) {\n        const query = {\n          depth: 0,\n          draft: true,\n          limit: idsToLoad.length,\n          locale,\n          where: {\n            id: {\n              in: idsToLoad,\n            },\n          },\n        }\n\n        if (!errorLoading) {\n          const response = await fetch(`${serverURL}${api}/${relation}`, {\n            body: qs.stringify(query),\n            credentials: 'include',\n            headers: {\n              'Accept-Language': i18n.language,\n              'Content-Type': 'application/x-www-form-urlencoded',\n              'X-HTTP-Method-Override': 'GET',\n            },\n            method: 'POST',\n          })\n\n          const collection = getEntityConfig({ collectionSlug: relation })\n          let docs = []\n\n          if (response.ok) {\n            const data = await response.json()\n            docs = data.docs\n          }\n\n          dispatchOptions({\n            type: 'ADD',\n            collection,\n            config,\n            docs,\n            i18n,\n            ids: idsToLoad,\n            sort: true,\n          })\n        }\n      }\n    }, Promise.resolve())\n  })\n\n  const prevValue = useRef(value)\n  const isFirstRenderRef = useRef(true)\n  // ///////////////////////////////////\n  // Ensure we have an option for each value\n  // ///////////////////////////////////\n  useEffect(() => {\n    if (isFirstRenderRef.current || !dequal(value, prevValue.current)) {\n      handleValueChange(value)\n    }\n    isFirstRenderRef.current = false\n    prevValue.current = value\n  }, [value])\n\n  // Determine if we should switch to word boundary search\n  useEffect(() => {\n    const relations = Array.isArray(relationTo) ? relationTo : [relationTo]\n    const isIdOnly = relations.reduce((idOnly, relation) => {\n      const collection = getEntityConfig({ collectionSlug: relation })\n      const fieldToSearch = collection?.admin?.useAsTitle || 'id'\n      return fieldToSearch === 'id' && idOnly\n    }, true)\n    setEnableWordBoundarySearch(!isIdOnly)\n  }, [relationTo, getEntityConfig])\n\n  const getResultsEffectEvent: GetResults = useEffectEvent(async (args) => {\n    return await getResults(args)\n  })\n\n  // When (`relationTo` || `filterOptions` || `locale`) changes, reset component\n  // Note - effect should not run on first run\n  useEffect(() => {\n    // If the menu is open while filterOptions changes\n    // due to latency of form state and fast clicking into this field,\n    // re-fetch options\n    if (hasLoadedFirstPageRef.current && menuIsOpen) {\n      setIsLoading(true)\n      void getResultsEffectEvent({\n        filterOptions,\n        lastLoadedPage: {},\n        onSuccess: () => {\n          hasLoadedFirstPageRef.current = true\n          setIsLoading(false)\n        },\n        value: valueRef.current,\n      })\n    }\n\n    // If the menu is not open, still reset the field state\n    // because we need to get new options next time the menu opens\n    dispatchOptions({\n      type: 'CLEAR',\n      exemptValues: valueRef.current,\n    })\n\n    setLastFullyLoadedRelation(-1)\n    setLastLoadedPage({})\n  }, [relationTo, filterOptions, locale, path, menuIsOpen])\n\n  const onSave = useCallback<DocumentDrawerProps['onSave']>(\n    (args) => {\n      dispatchOptions({\n        type: 'UPDATE',\n        collection: args.collectionConfig,\n        config,\n        doc: args.doc,\n        i18n,\n      })\n\n      const currentValue = valueRef.current\n      const docID = args.doc.id\n\n      if (hasMany) {\n        const unchanged = (currentValue as Option[]).some((option) =>\n          typeof option === 'string' ? option === docID : option.value === docID,\n        )\n\n        const valuesToSet = (currentValue as Option[]).map((option) =>\n          option.value === docID\n            ? { relationTo: args.collectionConfig.slug, value: docID }\n            : option,\n        )\n\n        setValue(valuesToSet, unchanged)\n      } else {\n        const unchanged = currentValue === docID\n\n        setValue({ relationTo: args.collectionConfig.slug, value: docID }, unchanged)\n      }\n    },\n    [i18n, config, hasMany, setValue],\n  )\n\n  const onDuplicate = useCallback<DocumentDrawerProps['onDuplicate']>(\n    (args) => {\n      dispatchOptions({\n        type: 'ADD',\n        collection: args.collectionConfig,\n        config,\n        docs: [args.doc],\n        i18n,\n        sort: true,\n      })\n\n      if (hasMany) {\n        setValue(\n          valueRef.current\n            ? (valueRef.current as Option[]).concat({\n                relationTo: args.collectionConfig.slug,\n                value: args.doc.id,\n              } as Option)\n            : null,\n        )\n      } else {\n        setValue({\n          relationTo: args.collectionConfig.slug,\n          value: args.doc.id,\n        })\n      }\n    },\n    [i18n, config, hasMany, setValue],\n  )\n\n  const onDelete = useCallback<DocumentDrawerProps['onDelete']>(\n    (args) => {\n      dispatchOptions({\n        id: args.id,\n        type: 'REMOVE',\n        collection: args.collectionConfig,\n        config,\n        i18n,\n      })\n\n      if (hasMany) {\n        setValue(\n          valueRef.current\n            ? (valueRef.current as Option[]).filter((option) => {\n                return option.value !== args.id\n              })\n            : null,\n        )\n      } else {\n        setValue(null)\n      }\n\n      return\n    },\n    [i18n, config, hasMany, setValue],\n  )\n\n  const filterOption = useCallback((item: Option, searchFilter: string) => {\n    if (!searchFilter) {\n      return true\n    }\n    const r = wordBoundariesRegex(searchFilter || '')\n    // breaking the labels to search into smaller parts increases performance\n    const breakApartThreshold = 250\n    let labelString = String(item.label)\n    // strings less than breakApartThreshold length won't be chunked\n    while (labelString.length > breakApartThreshold) {\n      // slicing by the next space after the length of the search input prevents slicing the string up by partial words\n      const indexOfSpace = labelString.indexOf(' ', searchFilter.length)\n      if (\n        r.test(labelString.slice(0, indexOfSpace === -1 ? searchFilter.length : indexOfSpace + 1))\n      ) {\n        return true\n      }\n      labelString = labelString.slice(indexOfSpace === -1 ? searchFilter.length : indexOfSpace + 1)\n    }\n    return r.test(labelString.slice(-breakApartThreshold))\n  }, [])\n\n  const onDocumentDrawerOpen = useCallback<\n    ReactSelectAdapterProps['customProps']['onDocumentDrawerOpen']\n  >(({ id, collectionSlug, hasReadPermission }) => {\n    openDrawerWhenRelationChanges.current = true\n    setCurrentlyOpenRelationship({\n      id,\n      collectionSlug,\n      hasReadPermission,\n    })\n  }, [])\n\n  useEffect(() => {\n    if (openDrawerWhenRelationChanges.current) {\n      openDrawer()\n      openDrawerWhenRelationChanges.current = false\n    }\n  }, [openDrawer, currentlyOpenRelationship])\n\n  const valueToRender = findOptionsByValue({ allowEdit, options, value })\n\n  if (!Array.isArray(valueToRender) && valueToRender?.value === 'null') {\n    valueToRender.value = null\n  }\n\n  const styles = useMemo(() => mergeFieldStyles(field), [field])\n\n  return (\n    <div\n      className={[\n        fieldBaseClass,\n        baseClass,\n        className,\n        showError && 'error',\n        errorLoading && 'error-loading',\n        (readOnly || disabled) && `${baseClass}--read-only`,\n        !(readOnly || disabled) && allowCreate && `${baseClass}--allow-create`,\n      ]\n        .filter(Boolean)\n        .join(' ')}\n      id={`field-${path.replace(/\\./g, '__')}`}\n      style={styles}\n    >\n      <RenderCustomComponent\n        CustomComponent={Label}\n        Fallback={\n          <FieldLabel label={label} localized={localized} path={path} required={required} />\n        }\n      />\n      <div className={`${fieldBaseClass}__wrap`}>\n        <RenderCustomComponent\n          CustomComponent={Error}\n          Fallback={<FieldError path={path} showError={showError} />}\n        />\n        {BeforeInput}\n        {!errorLoading && (\n          <div className={`${baseClass}__wrap`}>\n            <ReactSelect\n              backspaceRemovesValue={!(isDrawerOpen || isListDrawerOpen)}\n              components={{\n                MultiValueLabel,\n                SingleValue,\n                ...(appearance !== 'select' && { DropdownIndicator: null }),\n              }}\n              customProps={{\n                disableKeyDown: isDrawerOpen || isListDrawerOpen,\n                disableMouseDown: isDrawerOpen || isListDrawerOpen,\n                onDocumentDrawerOpen,\n                onSave,\n              }}\n              disabled={readOnly || disabled || isDrawerOpen || isListDrawerOpen}\n              filterOption={enableWordBoundarySearch ? filterOption : undefined}\n              getOptionValue={(option) => {\n                if (!option) {\n                  return undefined\n                }\n                return hasMany && Array.isArray(relationTo)\n                  ? `${option.relationTo}_${option.value}`\n                  : (option.value as string)\n              }}\n              isLoading={appearance === 'select' && isLoading}\n              isMulti={hasMany}\n              isSearchable={appearance === 'select'}\n              isSortable={isSortable}\n              menuIsOpen={appearance === 'select' ? menuIsOpen : false}\n              onChange={\n                !(readOnly || disabled)\n                  ? (selected) => {\n                      if (selected === null) {\n                        setValue(hasMany ? [] : null)\n                      } else if (hasMany && Array.isArray(selected)) {\n                        setValue(\n                          selected\n                            ? selected.map((option) => {\n                                if (hasMultipleRelations) {\n                                  return {\n                                    relationTo: option.relationTo,\n                                    value: option.value,\n                                  }\n                                }\n\n                                return option.value\n                              })\n                            : null,\n                        )\n                      } else if (hasMultipleRelations && !Array.isArray(selected)) {\n                        setValue({\n                          relationTo: selected.relationTo,\n                          value: selected.value,\n                        })\n                      } else if (!Array.isArray(selected)) {\n                        setValue(selected.value)\n                      }\n                    }\n                  : undefined\n              }\n              onInputChange={(newSearch) => handleInputChange(newSearch, value)}\n              onMenuClose={() => {\n                setMenuIsOpen(false)\n              }}\n              onMenuOpen={() => {\n                if (appearance === 'drawer') {\n                  openListDrawer()\n                } else if (appearance === 'select') {\n                  setMenuIsOpen(true)\n                  if (!hasLoadedFirstPageRef.current) {\n                    setIsLoading(true)\n                    void getResults({\n                      filterOptions,\n                      lastLoadedPage: {},\n                      onSuccess: () => {\n                        hasLoadedFirstPageRef.current = true\n                        setIsLoading(false)\n                      },\n                      value: initialValue,\n                    })\n                  }\n                }\n              }}\n              onMenuScrollToBottom={() => {\n                void getResults({\n                  filterOptions,\n                  lastFullyLoadedRelation,\n                  lastLoadedPage,\n                  search,\n                  sort: false,\n                  value: initialValue,\n                })\n              }}\n              options={options}\n              showError={showError}\n              value={valueToRender ?? null}\n            />\n            {!(readOnly || disabled) && allowCreate && (\n              <AddNewRelation\n                hasMany={hasMany}\n                path={path}\n                relationTo={relationTo}\n                setValue={setValue}\n                value={value}\n              />\n            )}\n          </div>\n        )}\n        {errorLoading && <div className={`${baseClass}__error-loading`}>{errorLoading}</div>}\n        {AfterInput}\n        <RenderCustomComponent\n          CustomComponent={Description}\n          Fallback={<FieldDescription description={description} path={path} />}\n        />\n      </div>\n      {currentlyOpenRelationship.collectionSlug && currentlyOpenRelationship.hasReadPermission && (\n        <DocumentDrawer onDelete={onDelete} onDuplicate={onDuplicate} onSave={onSave} />\n      )}\n      {appearance === 'drawer' && !readOnly && (\n        <ListDrawer allowCreate={allowCreate} enableRowSelections={false} onSelect={onListSelect} />\n      )}\n    </div>\n  )\n}\n\nexport const RelationshipField = withCondition(RelationshipFieldComponent)\n"],"mappings":"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","ignoreList":[]}