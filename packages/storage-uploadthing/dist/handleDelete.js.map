{"version":3,"sources":["../src/handleDelete.ts"],"sourcesContent":["import type { HandleDelete } from '@payloadcms/plugin-cloud-storage/types'\nimport type { UTApi } from 'uploadthing/server'\n\nimport { APIError } from 'payload'\n\nimport { getKeyFromFilename } from './utilities.js'\n\ntype Args = {\n  utApi: UTApi\n}\n\nexport const getHandleDelete = ({ utApi }: Args): HandleDelete => {\n  return async ({ doc, filename, req }) => {\n    const key = getKeyFromFilename(doc, filename)\n\n    if (!key) {\n      req.payload.logger.error({\n        msg: `Error deleting file: ${filename} - unable to extract key from doc`,\n      })\n      throw new APIError(`Error deleting file: ${filename}`)\n    }\n\n    try {\n      if (key) {\n        await utApi.deleteFiles(key)\n      }\n    } catch (err) {\n      req.payload.logger.error({\n        err,\n        msg: `Error deleting file with key: ${filename} - key: ${key}`,\n      })\n      throw new APIError(`Error deleting file: ${filename}`)\n    }\n  }\n}\n"],"names":["APIError","getKeyFromFilename","getHandleDelete","utApi","doc","filename","req","key","payload","logger","error","msg","deleteFiles","err"],"mappings":"AAGA,SAASA,QAAQ,QAAQ,UAAS;AAElC,SAASC,kBAAkB,QAAQ,iBAAgB;AAMnD,OAAO,MAAMC,kBAAkB,CAAC,EAAEC,KAAK,EAAQ;IAC7C,OAAO,OAAO,EAAEC,GAAG,EAAEC,QAAQ,EAAEC,GAAG,EAAE;QAClC,MAAMC,MAAMN,mBAAmBG,KAAKC;QAEpC,IAAI,CAACE,KAAK;YACRD,IAAIE,OAAO,CAACC,MAAM,CAACC,KAAK,CAAC;gBACvBC,KAAK,CAAC,qBAAqB,EAAEN,SAAS,iCAAiC,CAAC;YAC1E;YACA,MAAM,IAAIL,SAAS,CAAC,qBAAqB,EAAEK,UAAU;QACvD;QAEA,IAAI;YACF,IAAIE,KAAK;gBACP,MAAMJ,MAAMS,WAAW,CAACL;YAC1B;QACF,EAAE,OAAOM,KAAK;YACZP,IAAIE,OAAO,CAACC,MAAM,CAACC,KAAK,CAAC;gBACvBG;gBACAF,KAAK,CAAC,8BAA8B,EAAEN,SAAS,QAAQ,EAAEE,KAAK;YAChE;YACA,MAAM,IAAIP,SAAS,CAAC,qBAAqB,EAAEK,UAAU;QACvD;IACF;AACF,EAAC"}