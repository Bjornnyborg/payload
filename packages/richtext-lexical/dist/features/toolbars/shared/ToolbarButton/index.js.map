{"version":3,"file":"index.js","names":["c","_c","mergeRegister","$addUpdateTag","$getSelection","React","useCallback","useEffect","useState","useEditorConfigContext","baseClass","ToolbarButton","t0","$","children","editor","item","enabled","setEnabled","active","setActive","className","setClassName","editorConfigContext","t1","getEditorState","read","selection","isActive","isEnabled","updateStates","t2","t3","t4","t5","document","addEventListener","removeEventListener","t6","t7","registerUpdateListener","t8","key","filter","Boolean","join","t9","t10","focus","update","_temp","onSelect","t11","_jsx","onClick","onMouseDown","_temp2","type","e","preventDefault"],"sources":["../../../../../src/features/toolbars/shared/ToolbarButton/index.tsx"],"sourcesContent":["'use client'\nimport type { LexicalEditor } from 'lexical'\n\nimport { mergeRegister } from '@lexical/utils'\nimport { $addUpdateTag, $getSelection } from 'lexical'\nimport React, { useCallback, useEffect, useState } from 'react'\n\nimport type { ToolbarGroupItem } from '../../types.js'\n\nimport { useEditorConfigContext } from '../../../../lexical/config/client/EditorConfigProvider.js'\nimport './index.scss'\n\nconst baseClass = 'toolbar-popup__button'\n\nexport const ToolbarButton = ({\n  children,\n  editor,\n  item,\n}: {\n  children: React.JSX.Element\n  editor: LexicalEditor\n  item: ToolbarGroupItem\n}) => {\n  const [enabled, setEnabled] = useState<boolean>(true)\n  const [active, setActive] = useState<boolean>(false)\n  const [className, setClassName] = useState<string>(baseClass)\n  const editorConfigContext = useEditorConfigContext()\n\n  const updateStates = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection()\n      if (!selection) {\n        return\n      }\n      if (item.isActive) {\n        const isActive = item.isActive({ editor, editorConfigContext, selection })\n        if (active !== isActive) {\n          setActive(isActive)\n        }\n      }\n      if (item.isEnabled) {\n        const isEnabled = item.isEnabled({ editor, editorConfigContext, selection })\n        if (enabled !== isEnabled) {\n          setEnabled(isEnabled)\n        }\n      }\n    })\n  }, [active, editor, editorConfigContext, enabled, item])\n\n  useEffect(() => {\n    updateStates()\n  }, [updateStates])\n\n  useEffect(() => {\n    document.addEventListener('mouseup', updateStates)\n    return () => {\n      document.removeEventListener('mouseup', updateStates)\n    }\n  }, [updateStates])\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerUpdateListener(() => {\n        updateStates()\n      }),\n    )\n  }, [editor, updateStates])\n\n  useEffect(() => {\n    setClassName(\n      [\n        baseClass,\n        enabled === false ? 'disabled' : '',\n        active ? 'active' : '',\n        item?.key ? `${baseClass}-` + item.key : '',\n      ]\n        .filter(Boolean)\n        .join(' '),\n    )\n  }, [enabled, active, className, item.key])\n\n  return (\n    <button\n      className={className}\n      onClick={() => {\n        if (enabled !== false) {\n          editor.focus(() => {\n            editor.update(() => {\n              $addUpdateTag('toolbar')\n            })\n            // We need to wrap the onSelect in the callback, so the editor is properly focused before the onSelect is called.\n            item.onSelect?.({\n              editor,\n              isActive: active,\n            })\n          })\n\n          return true\n        }\n      }}\n      onMouseDown={(e) => {\n        // This fixes a bug where you are unable to click the button if you are in a NESTED editor (editor in blocks field in editor).\n        // Thus only happens if you click on the SVG of the button. Clicking on the outside works. Related issue: https://github.com/payloadcms/payload/issues/4025\n        // TODO: Find out why exactly it happens and why e.preventDefault() on the mouseDown fixes it. Write that down here, or potentially fix a root cause, if there is any.\n        e.preventDefault()\n      }}\n      type=\"button\"\n    >\n      {children}\n    </button>\n  )\n}\n"],"mappings":"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","ignoreList":[]}