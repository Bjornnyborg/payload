{"version":3,"sources":["../../../src/queues/utilities/sanitizeUpdateData.ts"],"sourcesContent":["import ObjectIdImport from 'bson-objectid'\n\nimport type { BaseJob } from '../config/types/workflowTypes.js'\n\nconst ObjectId = (ObjectIdImport.default ||\n  ObjectIdImport) as unknown as typeof ObjectIdImport.default\n\n/**\n * Our payload operations sanitize the input data to, for example, add missing IDs to array rows.\n * This function is used to manually sanitize the data for direct db adapter operations\n */\nexport function sanitizeUpdateData({ data }: { data: Partial<BaseJob> }): Partial<BaseJob> {\n  if (data.log) {\n    const sanitizedData = { ...data }\n    sanitizedData.log = sanitizedData?.log?.map((log) => {\n      if (log.id) {\n        return log\n      }\n      return {\n        ...log,\n        id: new ObjectId().toHexString(),\n      }\n    })\n    return sanitizedData\n  }\n\n  return data\n}\n"],"names":["ObjectIdImport","ObjectId","default","sanitizeUpdateData","data","log","sanitizedData","map","id","toHexString"],"mappings":"AAAA,OAAOA,oBAAoB,gBAAe;AAI1C,MAAMC,WAAYD,eAAeE,OAAO,IACtCF;AAEF;;;CAGC,GACD,OAAO,SAASG,mBAAmB,EAAEC,IAAI,EAA8B;IACrE,IAAIA,KAAKC,GAAG,EAAE;QACZ,MAAMC,gBAAgB;YAAE,GAAGF,IAAI;QAAC;QAChCE,cAAcD,GAAG,GAAGC,eAAeD,KAAKE,IAAI,CAACF;YAC3C,IAAIA,IAAIG,EAAE,EAAE;gBACV,OAAOH;YACT;YACA,OAAO;gBACL,GAAGA,GAAG;gBACNG,IAAI,IAAIP,WAAWQ,WAAW;YAChC;QACF;QACA,OAAOH;IACT;IAEA,OAAOF;AACT"}