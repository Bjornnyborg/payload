{"version":3,"sources":["../../src/schema/initCollections.ts"],"sourcesContent":["import type {\n  Collection,\n  Field,\n  GraphQLInfo,\n  SanitizedCollectionConfig,\n  SanitizedConfig,\n} from 'payload'\n\nimport {\n  GraphQLBoolean,\n  GraphQLInt,\n  GraphQLNonNull,\n  GraphQLObjectType,\n  GraphQLString,\n} from 'graphql'\nimport { buildVersionCollectionFields, flattenTopLevelFields, formatNames, toWords } from 'payload'\nimport { fieldAffectsData, getLoginOptions } from 'payload/shared'\n\nimport type { ObjectTypeConfig } from './buildObjectType.js'\n\nimport { forgotPassword } from '../resolvers/auth/forgotPassword.js'\nimport { init } from '../resolvers/auth/init.js'\nimport { login } from '../resolvers/auth/login.js'\nimport { logout } from '../resolvers/auth/logout.js'\nimport { me } from '../resolvers/auth/me.js'\nimport { refresh } from '../resolvers/auth/refresh.js'\nimport { resetPassword } from '../resolvers/auth/resetPassword.js'\nimport { unlock } from '../resolvers/auth/unlock.js'\nimport { verifyEmail } from '../resolvers/auth/verifyEmail.js'\nimport { countResolver } from '../resolvers/collections/count.js'\nimport { createResolver } from '../resolvers/collections/create.js'\nimport { getDeleteResolver } from '../resolvers/collections/delete.js'\nimport { docAccessResolver } from '../resolvers/collections/docAccess.js'\nimport { duplicateResolver } from '../resolvers/collections/duplicate.js'\nimport { findResolver } from '../resolvers/collections/find.js'\nimport { findByIDResolver } from '../resolvers/collections/findByID.js'\nimport { findVersionByIDResolver } from '../resolvers/collections/findVersionByID.js'\nimport { findVersionsResolver } from '../resolvers/collections/findVersions.js'\nimport { restoreVersionResolver } from '../resolvers/collections/restoreVersion.js'\nimport { updateResolver } from '../resolvers/collections/update.js'\nimport { formatName } from '../utilities/formatName.js'\nimport { buildMutationInputType, getCollectionIDType } from './buildMutationInputType.js'\nimport { buildObjectType } from './buildObjectType.js'\nimport { buildPaginatedListType } from './buildPaginatedListType.js'\nimport { buildPolicyType } from './buildPoliciesType.js'\nimport { buildWhereInputType } from './buildWhereInputType.js'\n\ntype InitCollectionsGraphQLArgs = {\n  config: SanitizedConfig\n  graphqlResult: GraphQLInfo\n}\nexport function initCollections({ config, graphqlResult }: InitCollectionsGraphQLArgs): void {\n  Object.keys(graphqlResult.collections).forEach((slug) => {\n    const collection: Collection = graphqlResult.collections[slug]\n    const {\n      config: collectionConfig,\n      config: { fields, graphQL = {} as SanitizedCollectionConfig['graphQL'], versions },\n    } = collection\n\n    if (!graphQL) {\n      return\n    }\n\n    let singularName\n    let pluralName\n\n    const fromSlug = formatNames(collection.config.slug)\n\n    if (graphQL.singularName) {\n      singularName = toWords(graphQL.singularName, true)\n    } else {\n      singularName = fromSlug.singular\n    }\n    if (graphQL.pluralName) {\n      pluralName = toWords(graphQL.pluralName, true)\n    } else {\n      pluralName = fromSlug.plural\n    }\n\n    // For collections named 'Media' or similar,\n    // there is a possibility that the singular name\n    // will equal the plural name. Append `all` to the beginning\n    // of potential conflicts\n    if (singularName === pluralName) {\n      pluralName = `all${singularName}`\n    }\n\n    collection.graphQL = {} as Collection['graphQL']\n\n    const hasIDField =\n      flattenTopLevelFields(fields).findIndex(\n        (field) => fieldAffectsData(field) && field.name === 'id',\n      ) > -1\n\n    const idType = getCollectionIDType(config.db.defaultIDType, collectionConfig)\n\n    const baseFields: ObjectTypeConfig = {}\n\n    const whereInputFields = [...fields]\n\n    if (!hasIDField) {\n      baseFields.id = { type: new GraphQLNonNull(idType) }\n      whereInputFields.push({\n        name: 'id',\n        type: config.db.defaultIDType as 'text',\n      })\n    }\n\n    const forceNullableObjectType = Boolean(versions?.drafts)\n\n    collection.graphQL.type = buildObjectType({\n      name: singularName,\n      baseFields,\n      config,\n      fields,\n      forceNullable: forceNullableObjectType,\n      graphqlResult,\n      parentName: singularName,\n    })\n\n    collection.graphQL.paginatedType = buildPaginatedListType(pluralName, collection.graphQL.type)\n\n    collection.graphQL.whereInputType = buildWhereInputType({\n      name: singularName,\n      fields: whereInputFields,\n      parentName: singularName,\n    })\n\n    const mutationInputFields = [...fields]\n\n    if (\n      collectionConfig.auth &&\n      (!collectionConfig.auth.disableLocalStrategy ||\n        (typeof collectionConfig.auth.disableLocalStrategy === 'object' &&\n          collectionConfig.auth.disableLocalStrategy.optionalPassword))\n    ) {\n      mutationInputFields.push({\n        name: 'password',\n        type: 'text',\n        label: 'Password',\n        required: !(\n          typeof collectionConfig.auth.disableLocalStrategy === 'object' &&\n          collectionConfig.auth.disableLocalStrategy.optionalPassword\n        ),\n      })\n    }\n\n    let mutationCreateInputFields = mutationInputFields\n\n    if (\n      config.db.allowIDOnCreate &&\n      !collectionConfig.flattenedFields.some((field) => field.name === 'id')\n    ) {\n      mutationCreateInputFields = [\n        ...mutationCreateInputFields,\n        {\n          name: 'id',\n          type: config.db.defaultIDType,\n        } as Field,\n      ]\n    }\n\n    const createMutationInputType = buildMutationInputType({\n      name: singularName,\n      config,\n      fields: mutationCreateInputFields,\n      graphqlResult,\n      parentIsLocalized: false,\n      parentName: singularName,\n    })\n    if (createMutationInputType) {\n      collection.graphQL.mutationInputType = new GraphQLNonNull(createMutationInputType)\n    }\n\n    const updateMutationInputType = buildMutationInputType({\n      name: `${singularName}Update`,\n      config,\n      fields: mutationInputFields.filter(\n        (field) => !(fieldAffectsData(field) && field.name === 'id'),\n      ),\n      forceNullable: true,\n      graphqlResult,\n      parentIsLocalized: false,\n      parentName: `${singularName}Update`,\n    })\n    if (updateMutationInputType) {\n      collection.graphQL.updateMutationInputType = new GraphQLNonNull(updateMutationInputType)\n    }\n\n    const queriesEnabled =\n      typeof collectionConfig.graphQL !== 'object' || !collectionConfig.graphQL.disableQueries\n    const mutationsEnabled =\n      typeof collectionConfig.graphQL !== 'object' || !collectionConfig.graphQL.disableMutations\n\n    if (queriesEnabled) {\n      graphqlResult.Query.fields[singularName] = {\n        type: collection.graphQL.type,\n        args: {\n          id: { type: new GraphQLNonNull(idType) },\n          draft: { type: GraphQLBoolean },\n          ...(config.localization\n            ? {\n                fallbackLocale: { type: graphqlResult.types.fallbackLocaleInputType },\n                locale: { type: graphqlResult.types.localeInputType },\n              }\n            : {}),\n        },\n        resolve: findByIDResolver(collection),\n      }\n\n      graphqlResult.Query.fields[pluralName] = {\n        type: buildPaginatedListType(pluralName, collection.graphQL.type),\n        args: {\n          draft: { type: GraphQLBoolean },\n          where: { type: collection.graphQL.whereInputType },\n          ...(config.localization\n            ? {\n                fallbackLocale: { type: graphqlResult.types.fallbackLocaleInputType },\n                locale: { type: graphqlResult.types.localeInputType },\n              }\n            : {}),\n          limit: { type: GraphQLInt },\n          page: { type: GraphQLInt },\n          pagination: { type: GraphQLBoolean },\n          sort: { type: GraphQLString },\n        },\n        resolve: findResolver(collection),\n      }\n\n      graphqlResult.Query.fields[`count${pluralName}`] = {\n        type: new GraphQLObjectType({\n          name: `count${pluralName}`,\n          fields: {\n            totalDocs: { type: GraphQLInt },\n          },\n        }),\n        args: {\n          draft: { type: GraphQLBoolean },\n          where: { type: collection.graphQL.whereInputType },\n          ...(config.localization\n            ? {\n                locale: { type: graphqlResult.types.localeInputType },\n              }\n            : {}),\n        },\n        resolve: countResolver(collection),\n      }\n\n      graphqlResult.Query.fields[`docAccess${singularName}`] = {\n        type: buildPolicyType({\n          type: 'collection',\n          entity: collectionConfig,\n          scope: 'docAccess',\n          typeSuffix: 'DocAccess',\n        }),\n        args: {\n          id: { type: new GraphQLNonNull(idType) },\n        },\n        resolve: docAccessResolver(collection),\n      }\n    }\n\n    if (mutationsEnabled) {\n      graphqlResult.Mutation.fields[`create${singularName}`] = {\n        type: collection.graphQL.type,\n        args: {\n          ...(createMutationInputType\n            ? { data: { type: collection.graphQL.mutationInputType } }\n            : {}),\n          draft: { type: GraphQLBoolean },\n          ...(config.localization\n            ? {\n                locale: { type: graphqlResult.types.localeInputType },\n              }\n            : {}),\n        },\n        resolve: createResolver(collection),\n      }\n\n      graphqlResult.Mutation.fields[`update${singularName}`] = {\n        type: collection.graphQL.type,\n        args: {\n          id: { type: new GraphQLNonNull(idType) },\n          autosave: { type: GraphQLBoolean },\n          ...(updateMutationInputType\n            ? { data: { type: collection.graphQL.updateMutationInputType } }\n            : {}),\n          draft: { type: GraphQLBoolean },\n          ...(config.localization\n            ? {\n                locale: { type: graphqlResult.types.localeInputType },\n              }\n            : {}),\n        },\n        resolve: updateResolver(collection),\n      }\n\n      graphqlResult.Mutation.fields[`delete${singularName}`] = {\n        type: collection.graphQL.type,\n        args: {\n          id: { type: new GraphQLNonNull(idType) },\n        },\n        resolve: getDeleteResolver(collection),\n      }\n\n      if (collectionConfig.disableDuplicate !== true) {\n        graphqlResult.Mutation.fields[`duplicate${singularName}`] = {\n          type: collection.graphQL.type,\n          args: {\n            id: { type: new GraphQLNonNull(idType) },\n            ...(createMutationInputType\n              ? { data: { type: collection.graphQL.mutationInputType } }\n              : {}),\n          },\n          resolve: duplicateResolver(collection),\n        }\n      }\n    }\n\n    if (collectionConfig.versions) {\n      const versionIDType = config.db.defaultIDType === 'text' ? GraphQLString : GraphQLInt\n      const versionCollectionFields: Field[] = [\n        ...buildVersionCollectionFields(config, collectionConfig),\n        {\n          name: 'id',\n          type: config.db.defaultIDType as 'text',\n        },\n        {\n          name: 'createdAt',\n          type: 'date',\n          label: 'Created At',\n        },\n        {\n          name: 'updatedAt',\n          type: 'date',\n          label: 'Updated At',\n        },\n      ]\n\n      collection.graphQL.versionType = buildObjectType({\n        name: `${singularName}Version`,\n        config,\n        fields: versionCollectionFields,\n        forceNullable: forceNullableObjectType,\n        graphqlResult,\n        parentName: `${singularName}Version`,\n      })\n\n      if (queriesEnabled) {\n        graphqlResult.Query.fields[`version${formatName(singularName)}`] = {\n          type: collection.graphQL.versionType,\n          args: {\n            id: { type: versionIDType },\n            ...(config.localization\n              ? {\n                  fallbackLocale: { type: graphqlResult.types.fallbackLocaleInputType },\n                  locale: { type: graphqlResult.types.localeInputType },\n                }\n              : {}),\n          },\n          resolve: findVersionByIDResolver(collection),\n        }\n        graphqlResult.Query.fields[`versions${pluralName}`] = {\n          type: buildPaginatedListType(\n            `versions${formatName(pluralName)}`,\n            collection.graphQL.versionType,\n          ),\n          args: {\n            where: {\n              type: buildWhereInputType({\n                name: `versions${singularName}`,\n                fields: versionCollectionFields,\n                parentName: `versions${singularName}`,\n              }),\n            },\n            ...(config.localization\n              ? {\n                  fallbackLocale: { type: graphqlResult.types.fallbackLocaleInputType },\n                  locale: { type: graphqlResult.types.localeInputType },\n                }\n              : {}),\n            limit: { type: GraphQLInt },\n            page: { type: GraphQLInt },\n            pagination: { type: GraphQLBoolean },\n            sort: { type: GraphQLString },\n          },\n          resolve: findVersionsResolver(collection),\n        }\n      }\n\n      if (mutationsEnabled) {\n        graphqlResult.Mutation.fields[`restoreVersion${formatName(singularName)}`] = {\n          type: collection.graphQL.type,\n          args: {\n            id: { type: versionIDType },\n            draft: { type: GraphQLBoolean },\n          },\n          resolve: restoreVersionResolver(collection),\n        }\n      }\n    }\n\n    if (collectionConfig.auth) {\n      const authFields: Field[] =\n        collectionConfig.auth.disableLocalStrategy ||\n        (collectionConfig.auth.loginWithUsername &&\n          !collectionConfig.auth.loginWithUsername.allowEmailLogin &&\n          !collectionConfig.auth.loginWithUsername.requireEmail)\n          ? []\n          : [\n              {\n                name: 'email',\n                type: 'email',\n                required: true,\n              },\n            ]\n      collection.graphQL.JWT = buildObjectType({\n        name: formatName(`${slug}JWT`),\n        config,\n        fields: [\n          ...collectionConfig.fields.filter((field) => fieldAffectsData(field) && field.saveToJWT),\n          ...authFields,\n          {\n            name: 'collection',\n            type: 'text',\n            required: true,\n          },\n        ],\n        graphqlResult,\n        parentName: formatName(`${slug}JWT`),\n      })\n\n      if (queriesEnabled) {\n        graphqlResult.Query.fields[`me${singularName}`] = {\n          type: new GraphQLObjectType({\n            name: formatName(`${slug}Me`),\n            fields: {\n              collection: {\n                type: GraphQLString,\n              },\n              exp: {\n                type: GraphQLInt,\n              },\n              strategy: {\n                type: GraphQLString,\n              },\n              token: {\n                type: GraphQLString,\n              },\n              user: {\n                type: collection.graphQL.type,\n              },\n            },\n          }),\n          resolve: me(collection),\n        }\n\n        graphqlResult.Query.fields[`initialized${singularName}`] = {\n          type: GraphQLBoolean,\n          resolve: init(collection.config.slug),\n        }\n      }\n\n      if (mutationsEnabled) {\n        graphqlResult.Mutation.fields[`refreshToken${singularName}`] = {\n          type: new GraphQLObjectType({\n            name: formatName(`${slug}Refreshed${singularName}`),\n            fields: {\n              exp: {\n                type: GraphQLInt,\n              },\n              refreshedToken: {\n                type: GraphQLString,\n              },\n              strategy: {\n                type: GraphQLString,\n              },\n              user: {\n                type: collection.graphQL.JWT,\n              },\n            },\n          }),\n          resolve: refresh(collection),\n        }\n\n        graphqlResult.Mutation.fields[`logout${singularName}`] = {\n          type: GraphQLString,\n          resolve: logout(collection),\n        }\n\n        if (!collectionConfig.auth.disableLocalStrategy) {\n          const authArgs = {}\n\n          const { canLoginWithEmail, canLoginWithUsername } = getLoginOptions(\n            collectionConfig.auth.loginWithUsername,\n          )\n\n          if (canLoginWithEmail) {\n            authArgs['email'] = { type: new GraphQLNonNull(GraphQLString) }\n          }\n          if (canLoginWithUsername) {\n            authArgs['username'] = { type: new GraphQLNonNull(GraphQLString) }\n          }\n\n          if (collectionConfig.auth.maxLoginAttempts > 0) {\n            graphqlResult.Mutation.fields[`unlock${singularName}`] = {\n              type: new GraphQLNonNull(GraphQLBoolean),\n              args: authArgs,\n              resolve: unlock(collection),\n            }\n          }\n\n          graphqlResult.Mutation.fields[`login${singularName}`] = {\n            type: new GraphQLObjectType({\n              name: formatName(`${slug}LoginResult`),\n              fields: {\n                exp: {\n                  type: GraphQLInt,\n                },\n                token: {\n                  type: GraphQLString,\n                },\n                user: {\n                  type: collection.graphQL.type,\n                },\n              },\n            }),\n            args: {\n              ...authArgs,\n              password: { type: GraphQLString },\n            },\n            resolve: login(collection),\n          }\n\n          graphqlResult.Mutation.fields[`forgotPassword${singularName}`] = {\n            type: new GraphQLNonNull(GraphQLBoolean),\n            args: {\n              disableEmail: { type: GraphQLBoolean },\n              expiration: { type: GraphQLInt },\n              ...authArgs,\n            },\n            resolve: forgotPassword(collection),\n          }\n\n          graphqlResult.Mutation.fields[`resetPassword${singularName}`] = {\n            type: new GraphQLObjectType({\n              name: formatName(`${slug}ResetPassword`),\n              fields: {\n                token: { type: GraphQLString },\n                user: { type: collection.graphQL.type },\n              },\n            }),\n            args: {\n              password: { type: GraphQLString },\n              token: { type: GraphQLString },\n            },\n            resolve: resetPassword(collection),\n          }\n\n          graphqlResult.Mutation.fields[`verifyEmail${singularName}`] = {\n            type: GraphQLBoolean,\n            args: {\n              token: { type: GraphQLString },\n            },\n            resolve: verifyEmail(collection),\n          }\n        }\n      }\n    }\n  })\n}\n"],"names":["GraphQLBoolean","GraphQLInt","GraphQLNonNull","GraphQLObjectType","GraphQLString","buildVersionCollectionFields","flattenTopLevelFields","formatNames","toWords","fieldAffectsData","getLoginOptions","forgotPassword","init","login","logout","me","refresh","resetPassword","unlock","verifyEmail","countResolver","createResolver","getDeleteResolver","docAccessResolver","duplicateResolver","findResolver","findByIDResolver","findVersionByIDResolver","findVersionsResolver","restoreVersionResolver","updateResolver","formatName","buildMutationInputType","getCollectionIDType","buildObjectType","buildPaginatedListType","buildPolicyType","buildWhereInputType","initCollections","config","graphqlResult","Object","keys","collections","forEach","slug","collection","collectionConfig","fields","graphQL","versions","singularName","pluralName","fromSlug","singular","plural","hasIDField","findIndex","field","name","idType","db","defaultIDType","baseFields","whereInputFields","id","type","push","forceNullableObjectType","Boolean","drafts","forceNullable","parentName","paginatedType","whereInputType","mutationInputFields","auth","disableLocalStrategy","optionalPassword","label","required","mutationCreateInputFields","allowIDOnCreate","flattenedFields","some","createMutationInputType","parentIsLocalized","mutationInputType","updateMutationInputType","filter","queriesEnabled","disableQueries","mutationsEnabled","disableMutations","Query","args","draft","localization","fallbackLocale","types","fallbackLocaleInputType","locale","localeInputType","resolve","where","limit","page","pagination","sort","totalDocs","entity","scope","typeSuffix","Mutation","data","autosave","disableDuplicate","versionIDType","versionCollectionFields","versionType","authFields","loginWithUsername","allowEmailLogin","requireEmail","JWT","saveToJWT","exp","strategy","token","user","refreshedToken","authArgs","canLoginWithEmail","canLoginWithUsername","maxLoginAttempts","password","disableEmail","expiration"],"mappings":"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"}