{"version":3,"sources":["../../src/field/RichText.tsx"],"sourcesContent":["'use client'\n\nimport type { PayloadRequest } from 'payload'\nimport type { BaseEditor, BaseOperation } from 'slate'\nimport type { HistoryEditor } from 'slate-history'\nimport type { ReactEditor } from 'slate-react'\n\nimport { getTranslation } from '@payloadcms/translations'\nimport {\n  FieldDescription,\n  FieldError,\n  FieldLabel,\n  RenderCustomComponent,\n  useEditDepth,\n  useField,\n  useTranslation,\n} from '@payloadcms/ui'\nimport { mergeFieldStyles } from '@payloadcms/ui/shared'\nimport { isHotkey } from 'is-hotkey'\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react'\nimport { createEditor, Node, Element as SlateElement, Text, Transforms } from 'slate'\nimport { withHistory } from 'slate-history'\nimport { Editable, Slate, withReact } from 'slate-react'\n\nimport type { ElementNode, TextNode } from '../types.js'\nimport type { LoadedSlateFieldProps } from './types.js'\n\nimport { defaultRichTextValue } from '../data/defaultValue.js'\nimport { richTextValidate } from '../data/validation.js'\nimport { listTypes } from './elements/listTypes.js'\nimport { hotkeys } from './hotkeys.js'\nimport { toggleLeaf } from './leaves/toggle.js'\nimport { withEnterBreakOut } from './plugins/withEnterBreakOut.js'\nimport { withHTML } from './plugins/withHTML.js'\nimport { ElementButtonProvider } from './providers/ElementButtonProvider.js'\nimport { ElementProvider } from './providers/ElementProvider.js'\nimport { LeafButtonProvider } from './providers/LeafButtonProvider.js'\nimport { LeafProvider } from './providers/LeafProvider.js'\nimport './index.scss'\n\nconst baseClass = 'rich-text'\n\ndeclare module 'slate' {\n  interface CustomTypes {\n    Editor: BaseEditor & HistoryEditor & ReactEditor\n    Element: ElementNode\n    Text: TextNode\n  }\n}\n\nconst RichTextField: React.FC<LoadedSlateFieldProps> = (props) => {\n  const {\n    elements,\n    field,\n    field: {\n      name,\n      admin: { className, description, placeholder, readOnly: readOnlyFromAdmin } = {},\n      label,\n      required,\n    },\n    leaves,\n    path: pathFromProps,\n    plugins,\n    readOnly: readOnlyFromTopLevelProps,\n    schemaPath: schemaPathFromProps,\n    validate = richTextValidate,\n  } = props\n\n  const schemaPath = schemaPathFromProps ?? name\n\n  const readOnlyFromProps = readOnlyFromTopLevelProps || readOnlyFromAdmin\n\n  const { i18n } = useTranslation()\n  const editorRef = useRef(null)\n  const toolbarRef = useRef(null)\n\n  const drawerDepth = useEditDepth()\n  const drawerIsOpen = drawerDepth > 1\n\n  const memoizedValidate = useCallback(\n    (value, validationOptions) => {\n      if (typeof validate === 'function') {\n        return validate(value, {\n          ...validationOptions,\n          req: {\n            t: i18n.t,\n          } as PayloadRequest,\n          required,\n        })\n      }\n    },\n    [validate, required, i18n],\n  )\n\n  const {\n    customComponents: { Description, Error, Label } = {},\n    disabled: disabledFromField,\n    initialValue,\n    path,\n    setValue,\n    showError,\n    value,\n  } = useField({\n    potentiallyStalePath: pathFromProps,\n    validate: memoizedValidate,\n  })\n\n  const disabled = readOnlyFromProps || disabledFromField\n\n  const editor = useMemo(() => {\n    let CreatedEditor = withEnterBreakOut(withHistory(withReact(createEditor())))\n\n    CreatedEditor = withHTML(CreatedEditor)\n\n    if (plugins.length) {\n      CreatedEditor = plugins.reduce((editorWithPlugins, plugin) => {\n        return plugin(editorWithPlugins)\n      }, CreatedEditor)\n    }\n\n    return CreatedEditor\n  }, [plugins])\n\n  const renderElement = useCallback(\n    ({ attributes, children, element }) => {\n      // return <div {...attributes}>{children}</div>\n\n      const matchedElement = elements[element.type]\n      const Element = matchedElement?.Element\n\n      let attr = { ...attributes }\n\n      // this converts text alignment to margin when dealing with void elements\n      if (element.textAlign) {\n        if (element.type === 'relationship' || element.type === 'upload') {\n          switch (element.textAlign) {\n            case 'center':\n              attr = { ...attr, style: { marginLeft: 'auto', marginRight: 'auto' } }\n              break\n            case 'left':\n              attr = { ...attr, style: { marginRight: 'auto' } }\n              break\n            case 'right':\n              attr = { ...attr, style: { marginLeft: 'auto' } }\n              break\n            default:\n              attr = { ...attr, style: { textAlign: element.textAlign } }\n              break\n          }\n        } else if (element.type === 'li') {\n          switch (element.textAlign) {\n            case 'center':\n              attr = { ...attr, style: { listStylePosition: 'inside', textAlign: 'center' } }\n              break\n            case 'right':\n              attr = { ...attr, style: { listStylePosition: 'inside', textAlign: 'right' } }\n              break\n            case 'left':\n            default:\n              attr = { ...attr, style: { listStylePosition: 'outside', textAlign: 'left' } }\n              break\n          }\n        } else {\n          attr = { ...attr, style: { textAlign: element.textAlign } }\n        }\n      }\n\n      if (Element) {\n        const el = (\n          <ElementProvider\n            attributes={attr}\n            childNodes={children}\n            editorRef={editorRef}\n            element={element}\n            fieldProps={props}\n            path={path}\n            schemaPath={schemaPath}\n          >\n            {Element}\n          </ElementProvider>\n        )\n\n        return el\n      }\n\n      return <div {...attr}>{children}</div>\n    },\n    [elements, path, props, schemaPath],\n  )\n\n  const renderLeaf = useCallback(\n    ({ attributes, children, leaf }) => {\n      const matchedLeaves = Object.entries(leaves).filter(([leafName]) => leaf[leafName])\n\n      if (matchedLeaves.length > 0) {\n        return matchedLeaves.reduce(\n          (result, [, leafConfig], i) => {\n            if (leafConfig?.Leaf) {\n              const Leaf = leafConfig.Leaf\n\n              return (\n                <LeafProvider\n                  attributes={attributes}\n                  editorRef={editorRef}\n                  fieldProps={props}\n                  key={i}\n                  leaf={leaf}\n                  path={path}\n                  result={result}\n                  schemaPath={schemaPath}\n                >\n                  {Leaf}\n                </LeafProvider>\n              )\n            }\n\n            return result\n          },\n          <span {...attributes}>{children}</span>,\n        )\n      }\n\n      return <span {...attributes}>{children}</span>\n    },\n    [path, props, schemaPath, leaves],\n  )\n\n  // All slate changes fire the onChange event\n  // including selection changes\n  // so we will filter the set_selection operations out\n  // and only fire setValue when onChange is because of value\n  const handleChange = useCallback(\n    (val: unknown) => {\n      const ops = editor?.operations.filter((o: BaseOperation) => {\n        if (o) {\n          return o.type !== 'set_selection'\n        }\n        return false\n      })\n\n      if (ops && Array.isArray(ops) && ops.length > 0) {\n        if (!disabled && val !== defaultRichTextValue && val !== value) {\n          setValue(val)\n        }\n      }\n    },\n    [editor?.operations, disabled, setValue, value],\n  )\n\n  useEffect(() => {\n    function setClickableState(clickState: 'disabled' | 'enabled') {\n      const selectors = 'button, a, [role=\"button\"]'\n      const toolbarButtons: (HTMLAnchorElement | HTMLButtonElement)[] =\n        toolbarRef.current?.querySelectorAll(selectors)\n\n      ;(toolbarButtons || []).forEach((child) => {\n        const isButton = child.tagName === 'BUTTON'\n        const isDisabling = clickState === 'disabled'\n        child.setAttribute('tabIndex', isDisabling ? '-1' : '0')\n        if (isButton) {\n          child.setAttribute('disabled', isDisabling ? 'disabled' : null)\n        }\n      })\n    }\n\n    if (disabled) {\n      setClickableState('disabled')\n    }\n\n    return () => {\n      if (disabled) {\n        setClickableState('enabled')\n      }\n    }\n  }, [disabled])\n\n  // useEffect(() => {\n  //   // If there is a change to the initial value, we need to reset Slate history\n  //   // and clear selection because the old selection may no longer be valid\n  //   // as returned JSON may be modified in hooks and have a different shape\n  //   if (editor.selection) {\n  //     console.log('deselecting');\n  //     ReactEditor.deselect(editor);\n  //   }\n  // }, [path, editor]);\n\n  const styles = useMemo(() => mergeFieldStyles(field), [field])\n\n  const classes = [\n    baseClass,\n    'field-type',\n    className,\n    showError && 'error',\n    disabled && `${baseClass}--read-only`,\n  ]\n    .filter(Boolean)\n    .join(' ')\n\n  let valueToRender = value\n\n  if (typeof valueToRender === 'string') {\n    try {\n      const parsedJSON = JSON.parse(valueToRender)\n      valueToRender = parsedJSON\n    } catch (err) {\n      valueToRender = null\n    }\n  }\n\n  if (!valueToRender) {\n    valueToRender = defaultRichTextValue\n  }\n\n  return (\n    <div className={classes} style={styles}>\n      {Label || <FieldLabel label={label} path={path} required={required} />}\n      <div className={`${baseClass}__wrap`}>\n        <RenderCustomComponent\n          CustomComponent={Error}\n          Fallback={<FieldError path={path} showError={showError} />}\n        />\n        <Slate\n          editor={editor}\n          key={JSON.stringify({ initialValue, path })} // makes sure slate is completely re-rendered when initialValue changes, bypassing the slate-internal value memoization. That way, external changes to the form will update the editor\n          onChange={handleChange}\n          value={valueToRender as any[]}\n        >\n          <div className={`${baseClass}__wrapper`}>\n            {Object.keys(elements)?.length + Object.keys(leaves)?.length > 0 && (\n              <div\n                className={[`${baseClass}__toolbar`, drawerIsOpen && `${baseClass}__drawerIsOpen`]\n                  .filter(Boolean)\n                  .join(' ')}\n                ref={toolbarRef}\n              >\n                <div className={`${baseClass}__toolbar-wrap`}>\n                  {Object.values(elements).map((element) => {\n                    const Button = element?.Button\n\n                    if (Button) {\n                      return (\n                        <ElementButtonProvider\n                          disabled={disabled}\n                          fieldProps={props}\n                          key={element.name}\n                          path={path}\n                          schemaPath={schemaPath}\n                        >\n                          {Button}\n                        </ElementButtonProvider>\n                      )\n                    }\n\n                    return null\n                  })}\n                  {Object.values(leaves).map((leaf) => {\n                    const Button = leaf?.Button\n\n                    if (Button) {\n                      return (\n                        <LeafButtonProvider\n                          fieldProps={props}\n                          key={leaf.name}\n                          path={path}\n                          schemaPath={schemaPath}\n                        >\n                          {Button}\n                        </LeafButtonProvider>\n                      )\n                    }\n\n                    return null\n                  })}\n                </div>\n              </div>\n            )}\n            <div className={`${baseClass}__editor`} ref={editorRef}>\n              <Editable\n                className={`${baseClass}__input`}\n                id={`field-${path.replace(/\\./g, '__')}`}\n                onKeyDown={(event) => {\n                  if (event.key === 'Enter') {\n                    if (event.shiftKey) {\n                      event.preventDefault()\n                      editor.insertText('\\n')\n                    } else {\n                      const selectedElement = Node.descendant(\n                        editor,\n                        editor.selection.anchor.path.slice(0, -1),\n                      )\n\n                      if (SlateElement.isElement(selectedElement)) {\n                        // Allow hard enter to \"break out\" of certain elements\n                        if (editor.shouldBreakOutOnEnter(selectedElement)) {\n                          event.preventDefault()\n                          const selectedLeaf = Node.descendant(editor, editor.selection.anchor.path)\n\n                          if (\n                            Text.isText(selectedLeaf) &&\n                            String(selectedLeaf.text).length === editor.selection.anchor.offset\n                          ) {\n                            Transforms.insertNodes(editor, { children: [{ text: '' }] })\n                          } else {\n                            Transforms.splitNodes(editor)\n                            Transforms.setNodes(editor, {})\n                          }\n                        }\n                      }\n                    }\n                  }\n\n                  if (event.key === 'Backspace') {\n                    const selectedElement = Node.descendant(\n                      editor,\n                      editor.selection.anchor.path.slice(0, -1),\n                    )\n\n                    if (SlateElement.isElement(selectedElement) && selectedElement.type === 'li') {\n                      const selectedLeaf = Node.descendant(editor, editor.selection.anchor.path)\n                      if (Text.isText(selectedLeaf) && String(selectedLeaf.text).length === 0) {\n                        event.preventDefault()\n                        Transforms.unwrapNodes(editor, {\n                          match: (n) => SlateElement.isElement(n) && listTypes.includes(n.type),\n                          mode: 'lowest',\n                          split: true,\n                        })\n\n                        Transforms.setNodes(editor, { type: undefined })\n                      }\n                    } else if (editor.isVoid(selectedElement)) {\n                      Transforms.removeNodes(editor)\n                    }\n                  }\n\n                  Object.keys(hotkeys).forEach((hotkey) => {\n                    if (isHotkey(hotkey, event as any)) {\n                      event.preventDefault()\n                      const mark = hotkeys[hotkey]\n                      toggleLeaf(editor, mark)\n                    }\n                  })\n                }}\n                placeholder={getTranslation(placeholder, i18n)}\n                readOnly={disabled}\n                renderElement={renderElement}\n                renderLeaf={renderLeaf}\n                spellCheck\n              />\n            </div>\n          </div>\n        </Slate>\n        <RenderCustomComponent\n          CustomComponent={Description}\n          Fallback={<FieldDescription description={description} path={path} />}\n        />\n      </div>\n    </div>\n  )\n}\n\nexport const RichText = RichTextField\n"],"names":["getTranslation","FieldDescription","FieldError","FieldLabel","RenderCustomComponent","useEditDepth","useField","useTranslation","mergeFieldStyles","isHotkey","React","useCallback","useEffect","useMemo","useRef","createEditor","Node","Element","SlateElement","Text","Transforms","withHistory","Editable","Slate","withReact","defaultRichTextValue","richTextValidate","listTypes","hotkeys","toggleLeaf","withEnterBreakOut","withHTML","ElementButtonProvider","ElementProvider","LeafButtonProvider","LeafProvider","baseClass","RichTextField","props","elements","field","name","admin","className","description","placeholder","readOnly","readOnlyFromAdmin","label","required","leaves","path","pathFromProps","plugins","readOnlyFromTopLevelProps","schemaPath","schemaPathFromProps","validate","readOnlyFromProps","i18n","editorRef","toolbarRef","drawerDepth","drawerIsOpen","memoizedValidate","value","validationOptions","req","t","customComponents","Description","Error","Label","disabled","disabledFromField","initialValue","setValue","showError","potentiallyStalePath","editor","CreatedEditor","length","reduce","editorWithPlugins","plugin","renderElement","attributes","children","element","matchedElement","type","attr","textAlign","style","marginLeft","marginRight","listStylePosition","el","childNodes","fieldProps","div","renderLeaf","leaf","matchedLeaves","Object","entries","filter","leafName","result","leafConfig","i","Leaf","span","handleChange","val","ops","operations","o","Array","isArray","setClickableState","clickState","selectors","toolbarButtons","current","querySelectorAll","forEach","child","isButton","tagName","isDisabling","setAttribute","styles","classes","Boolean","join","valueToRender","parsedJSON","JSON","parse","err","CustomComponent","Fallback","onChange","keys","ref","values","map","Button","id","replace","onKeyDown","event","key","shiftKey","preventDefault","insertText","selectedElement","descendant","selection","anchor","slice","isElement","shouldBreakOutOnEnter","selectedLeaf","isText","String","text","offset","insertNodes","splitNodes","setNodes","unwrapNodes","match","n","includes","mode","split","undefined","isVoid","removeNodes","hotkey","mark","spellCheck","stringify","RichText"],"mappings":"AAAA;;AAOA,SAASA,cAAc,QAAQ,2BAA0B;AACzD,SACEC,gBAAgB,EAChBC,UAAU,EACVC,UAAU,EACVC,qBAAqB,EACrBC,YAAY,EACZC,QAAQ,EACRC,cAAc,QACT,iBAAgB;AACvB,SAASC,gBAAgB,QAAQ,wBAAuB;AACxD,SAASC,QAAQ,QAAQ,YAAW;AACpC,OAAOC,SAASC,WAAW,EAAEC,SAAS,EAAEC,OAAO,EAAEC,MAAM,QAAQ,QAAO;AACtE,SAASC,YAAY,EAAEC,IAAI,EAAEC,WAAWC,YAAY,EAAEC,IAAI,EAAEC,UAAU,QAAQ,QAAO;AACrF,SAASC,WAAW,QAAQ,gBAAe;AAC3C,SAASC,QAAQ,EAAEC,KAAK,EAAEC,SAAS,QAAQ,cAAa;AAKxD,SAASC,oBAAoB,QAAQ,0BAAyB;AAC9D,SAASC,gBAAgB,QAAQ,wBAAuB;AACxD,SAASC,SAAS,QAAQ,0BAAyB;AACnD,SAASC,OAAO,QAAQ,eAAc;AACtC,SAASC,UAAU,QAAQ,qBAAoB;AAC/C,SAASC,iBAAiB,QAAQ,iCAAgC;AAClE,SAASC,QAAQ,QAAQ,wBAAuB;AAChD,SAASC,qBAAqB,QAAQ,uCAAsC;AAC5E,SAASC,eAAe,QAAQ,iCAAgC;AAChE,SAASC,kBAAkB,QAAQ,oCAAmC;AACtE,SAASC,YAAY,QAAQ,8BAA6B;AAC1D,OAAO,eAAc;AAErB,MAAMC,YAAY;AAUlB,MAAMC,gBAAiD,CAACC;IACtD,MAAM,EACJC,QAAQ,EACRC,KAAK,EACLA,OAAO,EACLC,IAAI,EACJC,OAAO,EAAEC,SAAS,EAAEC,WAAW,EAAEC,WAAW,EAAEC,UAAUC,iBAAiB,EAAE,GAAG,CAAC,CAAC,EAChFC,KAAK,EACLC,QAAQ,EACT,EACDC,MAAM,EACNC,MAAMC,aAAa,EACnBC,OAAO,EACPP,UAAUQ,yBAAyB,EACnCC,YAAYC,mBAAmB,EAC/BC,WAAW/B,gBAAgB,EAC5B,GAAGY;IAEJ,MAAMiB,aAAaC,uBAAuBf;IAE1C,MAAMiB,oBAAoBJ,6BAA6BP;IAEvD,MAAM,EAAEY,IAAI,EAAE,GAAGpD;IACjB,MAAMqD,YAAY9C,OAAO;IACzB,MAAM+C,aAAa/C,OAAO;IAE1B,MAAMgD,cAAczD;IACpB,MAAM0D,eAAeD,cAAc;IAEnC,MAAME,mBAAmBrD,YACvB,CAACsD,OAAOC;QACN,IAAI,OAAOT,aAAa,YAAY;YAClC,OAAOA,SAASQ,OAAO;gBACrB,GAAGC,iBAAiB;gBACpBC,KAAK;oBACHC,GAAGT,KAAKS,CAAC;gBACX;gBACAnB;YACF;QACF;IACF,GACA;QAACQ;QAAUR;QAAUU;KAAK;IAG5B,MAAM,EACJU,kBAAkB,EAAEC,WAAW,EAAEC,KAAK,EAAEC,KAAK,EAAE,GAAG,CAAC,CAAC,EACpDC,UAAUC,iBAAiB,EAC3BC,YAAY,EACZxB,IAAI,EACJyB,QAAQ,EACRC,SAAS,EACTZ,KAAK,EACN,GAAG3D,SAAS;QACXwE,sBAAsB1B;QACtBK,UAAUO;IACZ;IAEA,MAAMS,WAAWf,qBAAqBgB;IAEtC,MAAMK,SAASlE,QAAQ;QACrB,IAAImE,gBAAgBlD,kBAAkBT,YAAYG,UAAUT;QAE5DiE,gBAAgBjD,SAASiD;QAEzB,IAAI3B,QAAQ4B,MAAM,EAAE;YAClBD,gBAAgB3B,QAAQ6B,MAAM,CAAC,CAACC,mBAAmBC;gBACjD,OAAOA,OAAOD;YAChB,GAAGH;QACL;QAEA,OAAOA;IACT,GAAG;QAAC3B;KAAQ;IAEZ,MAAMgC,gBAAgB1E,YACpB,CAAC,EAAE2E,UAAU,EAAEC,QAAQ,EAAEC,OAAO,EAAE;QAChC,+CAA+C;QAE/C,MAAMC,iBAAiBlD,QAAQ,CAACiD,QAAQE,IAAI,CAAC;QAC7C,MAAMzE,UAAUwE,gBAAgBxE;QAEhC,IAAI0E,OAAO;YAAE,GAAGL,UAAU;QAAC;QAE3B,yEAAyE;QACzE,IAAIE,QAAQI,SAAS,EAAE;YACrB,IAAIJ,QAAQE,IAAI,KAAK,kBAAkBF,QAAQE,IAAI,KAAK,UAAU;gBAChE,OAAQF,QAAQI,SAAS;oBACvB,KAAK;wBACHD,OAAO;4BAAE,GAAGA,IAAI;4BAAEE,OAAO;gCAAEC,YAAY;gCAAQC,aAAa;4BAAO;wBAAE;wBACrE;oBACF,KAAK;wBACHJ,OAAO;4BAAE,GAAGA,IAAI;4BAAEE,OAAO;gCAAEE,aAAa;4BAAO;wBAAE;wBACjD;oBACF,KAAK;wBACHJ,OAAO;4BAAE,GAAGA,IAAI;4BAAEE,OAAO;gCAAEC,YAAY;4BAAO;wBAAE;wBAChD;oBACF;wBACEH,OAAO;4BAAE,GAAGA,IAAI;4BAAEE,OAAO;gCAAED,WAAWJ,QAAQI,SAAS;4BAAC;wBAAE;wBAC1D;gBACJ;YACF,OAAO,IAAIJ,QAAQE,IAAI,KAAK,MAAM;gBAChC,OAAQF,QAAQI,SAAS;oBACvB,KAAK;wBACHD,OAAO;4BAAE,GAAGA,IAAI;4BAAEE,OAAO;gCAAEG,mBAAmB;gCAAUJ,WAAW;4BAAS;wBAAE;wBAC9E;oBACF,KAAK;wBACHD,OAAO;4BAAE,GAAGA,IAAI;4BAAEE,OAAO;gCAAEG,mBAAmB;gCAAUJ,WAAW;4BAAQ;wBAAE;wBAC7E;oBACF,KAAK;oBACL;wBACED,OAAO;4BAAE,GAAGA,IAAI;4BAAEE,OAAO;gCAAEG,mBAAmB;gCAAWJ,WAAW;4BAAO;wBAAE;wBAC7E;gBACJ;YACF,OAAO;gBACLD,OAAO;oBAAE,GAAGA,IAAI;oBAAEE,OAAO;wBAAED,WAAWJ,QAAQI,SAAS;oBAAC;gBAAE;YAC5D;QACF;QAEA,IAAI3E,SAAS;YACX,MAAMgF,mBACJ,KAAChE;gBACCqD,YAAYK;gBACZO,YAAYX;gBACZ3B,WAAWA;gBACX4B,SAASA;gBACTW,YAAY7D;gBACZa,MAAMA;gBACNI,YAAYA;0BAEXtC;;YAIL,OAAOgF;QACT;QAEA,qBAAO,KAACG;YAAK,GAAGT,IAAI;sBAAGJ;;IACzB,GACA;QAAChD;QAAUY;QAAMb;QAAOiB;KAAW;IAGrC,MAAM8C,aAAa1F,YACjB,CAAC,EAAE2E,UAAU,EAAEC,QAAQ,EAAEe,IAAI,EAAE;QAC7B,MAAMC,gBAAgBC,OAAOC,OAAO,CAACvD,QAAQwD,MAAM,CAAC,CAAC,CAACC,SAAS,GAAKL,IAAI,CAACK,SAAS;QAElF,IAAIJ,cAActB,MAAM,GAAG,GAAG;YAC5B,OAAOsB,cAAcrB,MAAM,CACzB,CAAC0B,QAAQ,GAAGC,WAAW,EAAEC;gBACvB,IAAID,YAAYE,MAAM;oBACpB,MAAMA,OAAOF,WAAWE,IAAI;oBAE5B,qBACE,KAAC5E;wBACCmD,YAAYA;wBACZ1B,WAAWA;wBACXuC,YAAY7D;wBAEZgE,MAAMA;wBACNnD,MAAMA;wBACNyD,QAAQA;wBACRrD,YAAYA;kCAEXwD;uBANID;gBASX;gBAEA,OAAOF;YACT,iBACA,KAACI;gBAAM,GAAG1B,UAAU;0BAAGC;;QAE3B;QAEA,qBAAO,KAACyB;YAAM,GAAG1B,UAAU;sBAAGC;;IAChC,GACA;QAACpC;QAAMb;QAAOiB;QAAYL;KAAO;IAGnC,4CAA4C;IAC5C,8BAA8B;IAC9B,qDAAqD;IACrD,2DAA2D;IAC3D,MAAM+D,eAAetG,YACnB,CAACuG;QACC,MAAMC,MAAMpC,QAAQqC,WAAWV,OAAO,CAACW;YACrC,IAAIA,GAAG;gBACL,OAAOA,EAAE3B,IAAI,KAAK;YACpB;YACA,OAAO;QACT;QAEA,IAAIyB,OAAOG,MAAMC,OAAO,CAACJ,QAAQA,IAAIlC,MAAM,GAAG,GAAG;YAC/C,IAAI,CAACR,YAAYyC,QAAQzF,wBAAwByF,QAAQjD,OAAO;gBAC9DW,SAASsC;YACX;QACF;IACF,GACA;QAACnC,QAAQqC;QAAY3C;QAAUG;QAAUX;KAAM;IAGjDrD,UAAU;QACR,SAAS4G,kBAAkBC,UAAkC;YAC3D,MAAMC,YAAY;YAClB,MAAMC,iBACJ9D,WAAW+D,OAAO,EAAEC,iBAAiBH;YAErCC,CAAAA,kBAAkB,EAAE,AAAD,EAAGG,OAAO,CAAC,CAACC;gBAC/B,MAAMC,WAAWD,MAAME,OAAO,KAAK;gBACnC,MAAMC,cAAcT,eAAe;gBACnCM,MAAMI,YAAY,CAAC,YAAYD,cAAc,OAAO;gBACpD,IAAIF,UAAU;oBACZD,MAAMI,YAAY,CAAC,YAAYD,cAAc,aAAa;gBAC5D;YACF;QACF;QAEA,IAAIzD,UAAU;YACZ+C,kBAAkB;QACpB;QAEA,OAAO;YACL,IAAI/C,UAAU;gBACZ+C,kBAAkB;YACpB;QACF;IACF,GAAG;QAAC/C;KAAS;IAEb,oBAAoB;IACpB,iFAAiF;IACjF,4EAA4E;IAC5E,4EAA4E;IAC5E,4BAA4B;IAC5B,kCAAkC;IAClC,oCAAoC;IACpC,MAAM;IACN,sBAAsB;IAEtB,MAAM2D,SAASvH,QAAQ,IAAML,iBAAiBgC,QAAQ;QAACA;KAAM;IAE7D,MAAM6F,UAAU;QACdjG;QACA;QACAO;QACAkC,aAAa;QACbJ,YAAY,GAAGrC,UAAU,WAAW,CAAC;KACtC,CACEsE,MAAM,CAAC4B,SACPC,IAAI,CAAC;IAER,IAAIC,gBAAgBvE;IAEpB,IAAI,OAAOuE,kBAAkB,UAAU;QACrC,IAAI;YACF,MAAMC,aAAaC,KAAKC,KAAK,CAACH;YAC9BA,gBAAgBC;QAClB,EAAE,OAAOG,KAAK;YACZJ,gBAAgB;QAClB;IACF;IAEA,IAAI,CAACA,eAAe;QAClBA,gBAAgB/G;IAClB;IAEA,qBACE,MAAC2E;QAAIzD,WAAW0F;QAASxC,OAAOuC;;YAC7B5D,uBAAS,KAACrE;gBAAW6C,OAAOA;gBAAOG,MAAMA;gBAAMF,UAAUA;;0BAC1D,MAACmD;gBAAIzD,WAAW,GAAGP,UAAU,MAAM,CAAC;;kCAClC,KAAChC;wBACCyI,iBAAiBtE;wBACjBuE,wBAAU,KAAC5I;4BAAWiD,MAAMA;4BAAM0B,WAAWA;;;kCAE/C,KAACtD;wBACCwD,QAAQA;wBAERgE,UAAU9B;wBACVhD,OAAOuE;kCAEP,cAAA,MAACpC;4BAAIzD,WAAW,GAAGP,UAAU,SAAS,CAAC;;gCACpCoE,OAAOwC,IAAI,CAACzG,WAAW0C,SAASuB,OAAOwC,IAAI,CAAC9F,SAAS+B,SAAS,mBAC7D,KAACmB;oCACCzD,WAAW;wCAAC,GAAGP,UAAU,SAAS,CAAC;wCAAE2B,gBAAgB,GAAG3B,UAAU,cAAc,CAAC;qCAAC,CAC/EsE,MAAM,CAAC4B,SACPC,IAAI,CAAC;oCACRU,KAAKpF;8CAEL,cAAA,MAACuC;wCAAIzD,WAAW,GAAGP,UAAU,cAAc,CAAC;;4CACzCoE,OAAO0C,MAAM,CAAC3G,UAAU4G,GAAG,CAAC,CAAC3D;gDAC5B,MAAM4D,SAAS5D,SAAS4D;gDAExB,IAAIA,QAAQ;oDACV,qBACE,KAACpH;wDACCyC,UAAUA;wDACV0B,YAAY7D;wDAEZa,MAAMA;wDACNI,YAAYA;kEAEX6F;uDAJI5D,QAAQ/C,IAAI;gDAOvB;gDAEA,OAAO;4CACT;4CACC+D,OAAO0C,MAAM,CAAChG,QAAQiG,GAAG,CAAC,CAAC7C;gDAC1B,MAAM8C,SAAS9C,MAAM8C;gDAErB,IAAIA,QAAQ;oDACV,qBACE,KAAClH;wDACCiE,YAAY7D;wDAEZa,MAAMA;wDACNI,YAAYA;kEAEX6F;uDAJI9C,KAAK7D,IAAI;gDAOpB;gDAEA,OAAO;4CACT;;;;8CAIN,KAAC2D;oCAAIzD,WAAW,GAAGP,UAAU,QAAQ,CAAC;oCAAE6G,KAAKrF;8CAC3C,cAAA,KAACtC;wCACCqB,WAAW,GAAGP,UAAU,OAAO,CAAC;wCAChCiH,IAAI,CAAC,MAAM,EAAElG,KAAKmG,OAAO,CAAC,OAAO,OAAO;wCACxCC,WAAW,CAACC;4CACV,IAAIA,MAAMC,GAAG,KAAK,SAAS;gDACzB,IAAID,MAAME,QAAQ,EAAE;oDAClBF,MAAMG,cAAc;oDACpB5E,OAAO6E,UAAU,CAAC;gDACpB,OAAO;oDACL,MAAMC,kBAAkB7I,KAAK8I,UAAU,CACrC/E,QACAA,OAAOgF,SAAS,CAACC,MAAM,CAAC7G,IAAI,CAAC8G,KAAK,CAAC,GAAG,CAAC;oDAGzC,IAAI/I,aAAagJ,SAAS,CAACL,kBAAkB;wDAC3C,sDAAsD;wDACtD,IAAI9E,OAAOoF,qBAAqB,CAACN,kBAAkB;4DACjDL,MAAMG,cAAc;4DACpB,MAAMS,eAAepJ,KAAK8I,UAAU,CAAC/E,QAAQA,OAAOgF,SAAS,CAACC,MAAM,CAAC7G,IAAI;4DAEzE,IACEhC,KAAKkJ,MAAM,CAACD,iBACZE,OAAOF,aAAaG,IAAI,EAAEtF,MAAM,KAAKF,OAAOgF,SAAS,CAACC,MAAM,CAACQ,MAAM,EACnE;gEACApJ,WAAWqJ,WAAW,CAAC1F,QAAQ;oEAAEQ,UAAU;wEAAC;4EAAEgF,MAAM;wEAAG;qEAAE;gEAAC;4DAC5D,OAAO;gEACLnJ,WAAWsJ,UAAU,CAAC3F;gEACtB3D,WAAWuJ,QAAQ,CAAC5F,QAAQ,CAAC;4DAC/B;wDACF;oDACF;gDACF;4CACF;4CAEA,IAAIyE,MAAMC,GAAG,KAAK,aAAa;gDAC7B,MAAMI,kBAAkB7I,KAAK8I,UAAU,CACrC/E,QACAA,OAAOgF,SAAS,CAACC,MAAM,CAAC7G,IAAI,CAAC8G,KAAK,CAAC,GAAG,CAAC;gDAGzC,IAAI/I,aAAagJ,SAAS,CAACL,oBAAoBA,gBAAgBnE,IAAI,KAAK,MAAM;oDAC5E,MAAM0E,eAAepJ,KAAK8I,UAAU,CAAC/E,QAAQA,OAAOgF,SAAS,CAACC,MAAM,CAAC7G,IAAI;oDACzE,IAAIhC,KAAKkJ,MAAM,CAACD,iBAAiBE,OAAOF,aAAaG,IAAI,EAAEtF,MAAM,KAAK,GAAG;wDACvEuE,MAAMG,cAAc;wDACpBvI,WAAWwJ,WAAW,CAAC7F,QAAQ;4DAC7B8F,OAAO,CAACC,IAAM5J,aAAagJ,SAAS,CAACY,MAAMnJ,UAAUoJ,QAAQ,CAACD,EAAEpF,IAAI;4DACpEsF,MAAM;4DACNC,OAAO;wDACT;wDAEA7J,WAAWuJ,QAAQ,CAAC5F,QAAQ;4DAAEW,MAAMwF;wDAAU;oDAChD;gDACF,OAAO,IAAInG,OAAOoG,MAAM,CAACtB,kBAAkB;oDACzCzI,WAAWgK,WAAW,CAACrG;gDACzB;4CACF;4CAEAyB,OAAOwC,IAAI,CAACpH,SAASkG,OAAO,CAAC,CAACuD;gDAC5B,IAAI5K,SAAS4K,QAAQ7B,QAAe;oDAClCA,MAAMG,cAAc;oDACpB,MAAM2B,OAAO1J,OAAO,CAACyJ,OAAO;oDAC5BxJ,WAAWkD,QAAQuG;gDACrB;4CACF;wCACF;wCACAzI,aAAa7C,eAAe6C,aAAac;wCACzCb,UAAU2B;wCACVY,eAAeA;wCACfgB,YAAYA;wCACZkF,UAAU;;;;;uBA3HX7C,KAAK8C,SAAS,CAAC;wBAAE7G;wBAAcxB;oBAAK;kCAgI3C,KAAC/C;wBACCyI,iBAAiBvE;wBACjBwE,wBAAU,KAAC7I;4BAAiB2C,aAAaA;4BAAaO,MAAMA;;;;;;;AAKtE;AAEA,OAAO,MAAMsI,WAAWpJ,cAAa"}