{"version":3,"sources":["../../../../../src/field/elements/link/LinkDrawer/index.tsx"],"sourcesContent":["'use client'\n\nimport type { FormProps } from '@payloadcms/ui'\n\nimport {\n  Drawer,\n  EditDepthProvider,\n  Form,\n  FormSubmit,\n  RenderFields,\n  useDocumentInfo,\n  useEditDepth,\n  useHotkey,\n  useServerFunctions,\n  useTranslation,\n} from '@payloadcms/ui'\nimport React, { useCallback, useRef } from 'react'\n\nimport type { Props } from './types.js'\n\nimport { linkFieldsSchemaPath } from '../shared.js'\nimport './index.scss'\n\nconst baseClass = 'rich-text-link-edit-modal'\n\nexport const LinkDrawer: React.FC<Props> = ({\n  drawerSlug,\n  fields,\n  handleModalSubmit,\n  initialState,\n  schemaPath,\n}) => {\n  const { t } = useTranslation()\n  const fieldMapPath = `${schemaPath}.${linkFieldsSchemaPath}`\n\n  const { id, collectionSlug, getDocPreferences, globalSlug } = useDocumentInfo()\n\n  const { getFormState } = useServerFunctions()\n\n  const onChange: FormProps['onChange'][0] = useCallback(\n    async ({ formState: prevFormState }) => {\n      const { state } = await getFormState({\n        id,\n        collectionSlug,\n        docPermissions: {\n          fields: true,\n        },\n        docPreferences: await getDocPreferences(),\n        formState: prevFormState,\n        globalSlug,\n        operation: 'update',\n        schemaPath: fieldMapPath ?? '',\n      })\n\n      return state\n    },\n\n    [getFormState, id, collectionSlug, getDocPreferences, globalSlug, fieldMapPath],\n  )\n\n  return (\n    <EditDepthProvider>\n      <Drawer className={baseClass} slug={drawerSlug} title={t('fields:editLink')}>\n        <Form\n          beforeSubmit={[onChange]}\n          disableValidationOnSubmit\n          initialState={initialState}\n          onChange={[onChange]}\n          onSubmit={handleModalSubmit}\n        >\n          <RenderFields\n            fields={fields}\n            forceRender\n            parentIndexPath=\"\"\n            parentPath={''}\n            parentSchemaPath=\"\"\n            permissions={true}\n            readOnly={false}\n          />\n          <LinkSubmit />\n        </Form>\n      </Drawer>\n    </EditDepthProvider>\n  )\n}\n\nconst LinkSubmit: React.FC = () => {\n  const { t } = useTranslation()\n  const ref = useRef<HTMLButtonElement>(null)\n  const editDepth = useEditDepth()\n\n  useHotkey({ cmdCtrlKey: true, editDepth, keyCodes: ['s'] }, (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n    if (ref?.current) {\n      ref.current.click()\n    }\n  })\n\n  return <FormSubmit ref={ref}>{t('general:submit')}</FormSubmit>\n}\n"],"names":["Drawer","EditDepthProvider","Form","FormSubmit","RenderFields","useDocumentInfo","useEditDepth","useHotkey","useServerFunctions","useTranslation","React","useCallback","useRef","linkFieldsSchemaPath","baseClass","LinkDrawer","drawerSlug","fields","handleModalSubmit","initialState","schemaPath","t","fieldMapPath","id","collectionSlug","getDocPreferences","globalSlug","getFormState","onChange","formState","prevFormState","state","docPermissions","docPreferences","operation","className","slug","title","beforeSubmit","disableValidationOnSubmit","onSubmit","forceRender","parentIndexPath","parentPath","parentSchemaPath","permissions","readOnly","LinkSubmit","ref","editDepth","cmdCtrlKey","keyCodes","e","preventDefault","stopPropagation","current","click"],"mappings":"AAAA;;AAIA,SACEA,MAAM,EACNC,iBAAiB,EACjBC,IAAI,EACJC,UAAU,EACVC,YAAY,EACZC,eAAe,EACfC,YAAY,EACZC,SAAS,EACTC,kBAAkB,EAClBC,cAAc,QACT,iBAAgB;AACvB,OAAOC,SAASC,WAAW,EAAEC,MAAM,QAAQ,QAAO;AAIlD,SAASC,oBAAoB,QAAQ,eAAc;AACnD,OAAO,eAAc;AAErB,MAAMC,YAAY;AAElB,OAAO,MAAMC,aAA8B,CAAC,EAC1CC,UAAU,EACVC,MAAM,EACNC,iBAAiB,EACjBC,YAAY,EACZC,UAAU,EACX;IACC,MAAM,EAAEC,CAAC,EAAE,GAAGZ;IACd,MAAMa,eAAe,GAAGF,WAAW,CAAC,EAAEP,sBAAsB;IAE5D,MAAM,EAAEU,EAAE,EAAEC,cAAc,EAAEC,iBAAiB,EAAEC,UAAU,EAAE,GAAGrB;IAE9D,MAAM,EAAEsB,YAAY,EAAE,GAAGnB;IAEzB,MAAMoB,WAAqCjB,YACzC,OAAO,EAAEkB,WAAWC,aAAa,EAAE;QACjC,MAAM,EAAEC,KAAK,EAAE,GAAG,MAAMJ,aAAa;YACnCJ;YACAC;YACAQ,gBAAgB;gBACdf,QAAQ;YACV;YACAgB,gBAAgB,MAAMR;YACtBI,WAAWC;YACXJ;YACAQ,WAAW;YACXd,YAAYE,gBAAgB;QAC9B;QAEA,OAAOS;IACT,GAEA;QAACJ;QAAcJ;QAAIC;QAAgBC;QAAmBC;QAAYJ;KAAa;IAGjF,qBACE,KAACrB;kBACC,cAAA,KAACD;YAAOmC,WAAWrB;YAAWsB,MAAMpB;YAAYqB,OAAOhB,EAAE;sBACvD,cAAA,MAACnB;gBACCoC,cAAc;oBAACV;iBAAS;gBACxBW,yBAAyB;gBACzBpB,cAAcA;gBACdS,UAAU;oBAACA;iBAAS;gBACpBY,UAAUtB;;kCAEV,KAACd;wBACCa,QAAQA;wBACRwB,WAAW;wBACXC,iBAAgB;wBAChBC,YAAY;wBACZC,kBAAiB;wBACjBC,aAAa;wBACbC,UAAU;;kCAEZ,KAACC;;;;;AAKX,EAAC;AAED,MAAMA,aAAuB;IAC3B,MAAM,EAAE1B,CAAC,EAAE,GAAGZ;IACd,MAAMuC,MAAMpC,OAA0B;IACtC,MAAMqC,YAAY3C;IAElBC,UAAU;QAAE2C,YAAY;QAAMD;QAAWE,UAAU;YAAC;SAAI;IAAC,GAAG,CAACC;QAC3DA,EAAEC,cAAc;QAChBD,EAAEE,eAAe;QACjB,IAAIN,KAAKO,SAAS;YAChBP,IAAIO,OAAO,CAACC,KAAK;QACnB;IACF;IAEA,qBAAO,KAACrD;QAAW6C,KAAKA;kBAAM3B,EAAE;;AAClC"}