{"version":3,"sources":["../../../src/field/plugins/withHTML.tsx"],"sourcesContent":["import { Transforms } from 'slate'\nimport { jsx } from 'slate-hyperscript'\n\nconst ELEMENT_TAGS = {\n  A: (el) => ({\n    type: 'link',\n    newTab: el.getAttribute('target') === '_blank',\n    url: el.getAttribute('href'),\n  }),\n  BLOCKQUOTE: () => ({ type: 'blockquote' }),\n  H1: () => ({ type: 'h1' }),\n  H2: () => ({ type: 'h2' }),\n  H3: () => ({ type: 'h3' }),\n  H4: () => ({ type: 'h4' }),\n  H5: () => ({ type: 'h5' }),\n  H6: () => ({ type: 'h6' }),\n  LI: () => ({ type: 'li' }),\n  OL: () => ({ type: 'ol' }),\n  P: () => ({}),\n  PRE: () => ({ type: 'code' }),\n  UL: () => ({ type: 'ul' }),\n}\n\nconst TEXT_TAGS = {\n  CODE: () => ({ code: true }),\n  DEL: () => ({ strikethrough: true }),\n  EM: () => ({ italic: true }),\n  I: () => ({ italic: true }),\n  S: () => ({ strikethrough: true }),\n  STRONG: () => ({ bold: true }),\n  U: () => ({ underline: true }),\n}\n\nconst deserialize = (el) => {\n  if (el.nodeType === 3) {\n    return el.textContent\n  }\n  if (el.nodeType !== 1) {\n    return null\n  }\n  if (el.nodeName === 'BR') {\n    return '\\n'\n  }\n\n  const { nodeName } = el\n  let parent = el\n\n  if (nodeName === 'PRE' && el.childNodes[0] && el.childNodes[0].nodeName === 'CODE') {\n    ;[parent] = el.childNodes\n  }\n\n  let children = Array.from(parent.childNodes).map(deserialize).flat()\n\n  if (children.length === 0) {\n    children = [{ text: '' }]\n  }\n\n  if (el.nodeName === 'BODY') {\n    return jsx('fragment', {}, children)\n  }\n\n  if (ELEMENT_TAGS[nodeName]) {\n    const attrs = ELEMENT_TAGS[nodeName](el)\n    return jsx('element', attrs, children)\n  }\n\n  if (TEXT_TAGS[nodeName]) {\n    const attrs = TEXT_TAGS[nodeName](el)\n    return children.map((child) => jsx('text', attrs, child))\n  }\n\n  return children\n}\n\nexport const withHTML = (incomingEditor) => {\n  const { insertData } = incomingEditor\n\n  const editor = incomingEditor\n\n  editor.insertData = (data) => {\n    if (!data.types.includes('application/x-slate-fragment')) {\n      const html = data.getData('text/html')\n\n      if (html) {\n        const parsed = new DOMParser().parseFromString(html, 'text/html')\n        const fragment = deserialize(parsed.body)\n        Transforms.insertFragment(editor, fragment)\n        return\n      }\n    }\n\n    insertData(data)\n  }\n\n  return editor\n}\n"],"names":["Transforms","jsx","ELEMENT_TAGS","A","el","type","newTab","getAttribute","url","BLOCKQUOTE","H1","H2","H3","H4","H5","H6","LI","OL","P","PRE","UL","TEXT_TAGS","CODE","code","DEL","strikethrough","EM","italic","I","S","STRONG","bold","U","underline","deserialize","nodeType","textContent","nodeName","parent","childNodes","children","Array","from","map","flat","length","text","attrs","child","withHTML","incomingEditor","insertData","editor","data","types","includes","html","getData","parsed","DOMParser","parseFromString","fragment","body","insertFragment"],"mappings":"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"}