{"version":3,"sources":["../../src/data/richTextRelationshipPromise.ts"],"sourcesContent":["import type {\n  CollectionConfig,\n  PayloadRequest,\n  PopulateType,\n  RichTextAdapter,\n  RichTextField,\n} from 'payload'\n\nimport type { AdapterArguments } from '../types.js'\n\nimport { populate } from './populate.js'\nimport { recurseNestedFields } from './recurseNestedFields.js'\n\nexport type Args = Parameters<\n  RichTextAdapter<any[], AdapterArguments>['graphQLPopulationPromises']\n>[0]\n\ntype RecurseRichTextArgs = {\n  children: unknown[]\n  currentDepth: number\n  depth: number\n  draft: boolean\n  field: RichTextField<any[], any, any>\n  overrideAccess: boolean\n  populateArg?: PopulateType\n  populationPromises: Promise<void>[]\n  req: PayloadRequest\n  showHiddenFields: boolean\n}\n\nexport const recurseRichText = ({\n  children,\n  currentDepth = 0,\n  depth,\n  draft,\n  field,\n  overrideAccess = false,\n  populateArg,\n  populationPromises,\n  req,\n  showHiddenFields,\n}: RecurseRichTextArgs): void => {\n  if (depth <= 0 || currentDepth > depth) {\n    return\n  }\n\n  if (Array.isArray(children)) {\n    ;(children as any[]).forEach((element) => {\n      if ((element.type === 'relationship' || element.type === 'upload') && element?.value?.id) {\n        const collection = req.payload.collections[element?.relationTo]\n\n        if (collection) {\n          populationPromises.push(\n            populate({\n              id: element.value.id,\n              collection,\n              currentDepth,\n              data: element,\n              depth,\n              draft,\n              field,\n              key: 'value',\n              overrideAccess,\n              req,\n              select:\n                req.payloadAPI !== 'GraphQL'\n                  ? (populateArg?.[collection.config.slug] ?? collection.config.defaultPopulate)\n                  : undefined,\n              showHiddenFields,\n            }),\n          )\n        }\n        if (\n          element.type === 'upload' &&\n          Array.isArray(field.admin?.upload?.collections?.[element?.relationTo]?.fields)\n        ) {\n          recurseNestedFields({\n            currentDepth,\n            data: element.fields || {},\n            depth,\n            draft,\n            fields: field.admin.upload.collections[element.relationTo].fields,\n            overrideAccess,\n            populateArg,\n            populationPromises,\n            req,\n            showHiddenFields,\n          })\n        }\n      }\n\n      if (element.type === 'link') {\n        if (element?.doc?.value && element?.doc?.relationTo) {\n          const collection = req.payload.collections[element?.doc?.relationTo]\n\n          if (collection) {\n            populationPromises.push(\n              populate({\n                id: element.doc.value,\n                collection,\n                currentDepth,\n                data: element.doc,\n                depth,\n                draft,\n                field,\n                key: 'value',\n                overrideAccess,\n                req,\n                select:\n                  req.payloadAPI !== 'GraphQL'\n                    ? (populateArg?.[collection.config.slug] ?? collection.config.defaultPopulate)\n                    : undefined,\n                showHiddenFields,\n              }),\n            )\n          }\n        }\n\n        if (Array.isArray(field.admin?.link?.fields)) {\n          recurseNestedFields({\n            currentDepth,\n            data: element.fields || {},\n            depth,\n            draft,\n            fields: field.admin?.link?.fields,\n            overrideAccess,\n            populateArg,\n            populationPromises,\n            req,\n            showHiddenFields,\n          })\n        }\n      }\n\n      if (element?.children) {\n        recurseRichText({\n          children: element.children,\n          currentDepth,\n          depth,\n          draft,\n          field,\n          overrideAccess,\n          populateArg,\n          populationPromises,\n          req,\n          showHiddenFields,\n        })\n      }\n    })\n  }\n}\n\nexport const richTextRelationshipPromise = ({\n  currentDepth,\n  depth,\n  draft,\n  field,\n  overrideAccess,\n  parentIsLocalized,\n  populateArg,\n  populationPromises,\n  req,\n  showHiddenFields,\n  siblingDoc,\n}: Args) => {\n  recurseRichText({\n    children: siblingDoc[field.name] as unknown[],\n    currentDepth,\n    depth,\n    draft,\n    field,\n    overrideAccess,\n    populateArg,\n    populationPromises,\n    req,\n    showHiddenFields,\n  })\n}\n"],"names":["populate","recurseNestedFields","recurseRichText","children","currentDepth","depth","draft","field","overrideAccess","populateArg","populationPromises","req","showHiddenFields","Array","isArray","forEach","element","type","value","id","collection","payload","collections","relationTo","push","data","key","select","payloadAPI","config","slug","defaultPopulate","undefined","admin","upload","fields","doc","link","richTextRelationshipPromise","parentIsLocalized","siblingDoc","name"],"mappings":"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"}