{"version":3,"sources":["../src/RefreshRouteOnSave.tsx"],"sourcesContent":["'use client'\n\nimport type React from 'react'\n\nimport { isDocumentEvent, ready } from '@payloadcms/live-preview'\nimport { useCallback, useEffect, useRef } from 'react'\n\nexport const RefreshRouteOnSave: React.FC<{\n  apiRoute?: string\n  depth?: number\n  refresh: () => void\n  serverURL: string\n}> = (props) => {\n  const { apiRoute, depth, refresh, serverURL } = props\n  const hasSentReadyMessage = useRef<boolean>(false)\n\n  const onMessage = useCallback(\n    (event: MessageEvent) => {\n      if (isDocumentEvent(event, serverURL)) {\n        if (typeof refresh === 'function') {\n          refresh()\n        } else {\n          // eslint-disable-next-line no-console\n          console.error('You must provide a refresh function to `RefreshRouteOnSave`')\n        }\n      }\n    },\n    [refresh, serverURL],\n  )\n\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      window.addEventListener('message', onMessage)\n    }\n\n    if (!hasSentReadyMessage.current) {\n      hasSentReadyMessage.current = true\n\n      ready({\n        serverURL,\n      })\n\n      // refresh after the ready message is sent to get the latest data\n      refresh()\n    }\n\n    return () => {\n      if (typeof window !== 'undefined') {\n        window.removeEventListener('message', onMessage)\n      }\n    }\n  }, [serverURL, onMessage, depth, apiRoute, refresh])\n\n  return null\n}\n"],"names":["isDocumentEvent","ready","useCallback","useEffect","useRef","RefreshRouteOnSave","props","apiRoute","depth","refresh","serverURL","hasSentReadyMessage","onMessage","event","console","error","window","addEventListener","current","removeEventListener"],"mappings":"AAAA;AAIA,SAASA,eAAe,EAAEC,KAAK,QAAQ,2BAA0B;AACjE,SAASC,WAAW,EAAEC,SAAS,EAAEC,MAAM,QAAQ,QAAO;AAEtD,OAAO,MAAMC,qBAKR,CAACC;IACJ,MAAM,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,OAAO,EAAEC,SAAS,EAAE,GAAGJ;IAChD,MAAMK,sBAAsBP,OAAgB;IAE5C,MAAMQ,YAAYV,YAChB,CAACW;QACC,IAAIb,gBAAgBa,OAAOH,YAAY;YACrC,IAAI,OAAOD,YAAY,YAAY;gBACjCA;YACF,OAAO;gBACL,sCAAsC;gBACtCK,QAAQC,KAAK,CAAC;YAChB;QACF;IACF,GACA;QAACN;QAASC;KAAU;IAGtBP,UAAU;QACR,IAAI,OAAOa,WAAW,aAAa;YACjCA,OAAOC,gBAAgB,CAAC,WAAWL;QACrC;QAEA,IAAI,CAACD,oBAAoBO,OAAO,EAAE;YAChCP,oBAAoBO,OAAO,GAAG;YAE9BjB,MAAM;gBACJS;YACF;YAEA,iEAAiE;YACjED;QACF;QAEA,OAAO;YACL,IAAI,OAAOO,WAAW,aAAa;gBACjCA,OAAOG,mBAAmB,CAAC,WAAWP;YACxC;QACF;IACF,GAAG;QAACF;QAAWE;QAAWJ;QAAOD;QAAUE;KAAQ;IAEnD,OAAO;AACT,EAAC"}