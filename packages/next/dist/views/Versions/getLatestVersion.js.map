{"version":3,"file":"getLatestVersion.js","names":["logError","getLatestVersion","args","slug","type","locale","overrideAccess","parentID","payload","req","status","and","equals","push","parent","sharedOptions","depth","limit","sort","where","response","findVersions","collection","findGlobalVersions","docs","length","id","updatedAt","err"],"sources":["../../../src/views/Versions/getLatestVersion.ts"],"sourcesContent":["import type { Payload, PayloadRequest, Where } from 'payload'\n\nimport { logError } from 'payload'\n\ntype ReturnType = {\n  id: string\n  updatedAt: string\n} | null\n\ntype Args = {\n  locale?: string\n  overrideAccess?: boolean\n  parentID?: number | string\n  payload: Payload\n  req?: PayloadRequest\n  slug: string\n  status: 'draft' | 'published'\n  type: 'collection' | 'global'\n}\nexport async function getLatestVersion(args: Args): Promise<ReturnType> {\n  const { slug, type = 'collection', locale, overrideAccess, parentID, payload, req, status } = args\n\n  const and: Where[] = [\n    {\n      'version._status': {\n        equals: status,\n      },\n    },\n  ]\n\n  if (type === 'collection' && parentID) {\n    and.push({\n      parent: {\n        equals: parentID,\n      },\n    })\n  }\n\n  try {\n    const sharedOptions = {\n      depth: 0,\n      limit: 1,\n      locale,\n      overrideAccess,\n      req,\n      sort: '-updatedAt',\n      where: {\n        and,\n      },\n    }\n\n    const response =\n      type === 'collection'\n        ? await payload.findVersions({\n            collection: slug,\n            ...sharedOptions,\n          })\n        : await payload.findGlobalVersions({\n            slug,\n            ...sharedOptions,\n          })\n\n    if (!response.docs.length) {\n      return null\n    }\n\n    return {\n      id: response.docs[0].id,\n      updatedAt: response.docs[0].updatedAt,\n    }\n  } catch (err) {\n    logError({ err, payload })\n\n    return null\n  }\n}\n"],"mappings":"AAEA,SAASA,QAAQ,QAAQ;AAiBzB,OAAO,eAAeC,iBAAiBC,IAAU;EAC/C,MAAM;IAAEC,IAAI;IAAEC,IAAA,GAAO,YAAY;IAAEC,MAAM;IAAEC,cAAc;IAAEC,QAAQ;IAAEC,OAAO;IAAEC,GAAG;IAAEC;EAAM,CAAE,GAAGR,IAAA;EAE9F,MAAMS,GAAA,GAAe,CACnB;IACE,mBAAmB;MACjBC,MAAA,EAAQF;IACV;EACF,EACD;EAED,IAAIN,IAAA,KAAS,gBAAgBG,QAAA,EAAU;IACrCI,GAAA,CAAIE,IAAI,CAAC;MACPC,MAAA,EAAQ;QACNF,MAAA,EAAQL;MACV;IACF;EACF;EAEA,IAAI;IACF,MAAMQ,aAAA,GAAgB;MACpBC,KAAA,EAAO;MACPC,KAAA,EAAO;MACPZ,MAAA;MACAC,cAAA;MACAG,GAAA;MACAS,IAAA,EAAM;MACNC,KAAA,EAAO;QACLR;MACF;IACF;IAEA,MAAMS,QAAA,GACJhB,IAAA,KAAS,eACL,MAAMI,OAAA,CAAQa,YAAY,CAAC;MACzBC,UAAA,EAAYnB,IAAA;MACZ,GAAGY;IACL,KACA,MAAMP,OAAA,CAAQe,kBAAkB,CAAC;MAC/BpB,IAAA;MACA,GAAGY;IACL;IAEN,IAAI,CAACK,QAAA,CAASI,IAAI,CAACC,MAAM,EAAE;MACzB,OAAO;IACT;IAEA,OAAO;MACLC,EAAA,EAAIN,QAAA,CAASI,IAAI,CAAC,EAAE,CAACE,EAAE;MACvBC,SAAA,EAAWP,QAAA,CAASI,IAAI,CAAC,EAAE,CAACG;IAC9B;EACF,EAAE,OAAOC,GAAA,EAAK;IACZ5B,QAAA,CAAS;MAAE4B,GAAA;MAAKpB;IAAQ;IAExB,OAAO;EACT;AACF","ignoreList":[]}