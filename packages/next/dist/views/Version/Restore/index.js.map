{"version":3,"file":"index.js","names":["getTranslation","Button","ConfirmationModal","PopupList","toast","useConfig","useModal","useRouteTransition","useTranslation","requests","useRouter","formatAdminURL","React","Fragment","useCallback","useState","baseClass","modalSlug","Restore","className","collectionSlug","globalSlug","label","originalDocID","status","versionDate","versionID","config","routes","admin","adminRoute","api","apiRoute","serverURL","getEntityConfig","collectionConfig","toggleModal","router","i18n","t","draft","setDraft","startRouteTransition","restoreMessage","fetchURL","redirectURL","canRestoreAsDraft","versions","drafts","path","handleRestore","res","post","headers","language","json","success","message","push","error","_jsxs","_jsx","filter","Boolean","join","buttonStyle","onClick","size","SubMenuPopupContent","ButtonGroup","body","confirmingLabel","heading","onConfirm"],"sources":["../../../../src/views/Version/Restore/index.tsx"],"sourcesContent":["'use client'\n\nimport { getTranslation } from '@payloadcms/translations'\nimport {\n  Button,\n  ConfirmationModal,\n  PopupList,\n  toast,\n  useConfig,\n  useModal,\n  useRouteTransition,\n  useTranslation,\n} from '@payloadcms/ui'\nimport { requests } from '@payloadcms/ui/shared'\nimport { useRouter } from 'next/navigation.js'\nimport { formatAdminURL } from 'payload/shared'\nimport React, { Fragment, useCallback, useState } from 'react'\n\nimport type { Props } from './types.js'\n\nimport './index.scss'\n\nconst baseClass = 'restore-version'\nconst modalSlug = 'restore-version'\n\nconst Restore: React.FC<Props> = ({\n  className,\n  collectionSlug,\n  globalSlug,\n  label,\n  originalDocID,\n  status,\n  versionDate,\n  versionID,\n}) => {\n  const {\n    config: {\n      routes: { admin: adminRoute, api: apiRoute },\n      serverURL,\n    },\n    getEntityConfig,\n  } = useConfig()\n\n  const collectionConfig = getEntityConfig({ collectionSlug })\n\n  const { toggleModal } = useModal()\n  const router = useRouter()\n  const { i18n, t } = useTranslation()\n  const [draft, setDraft] = useState(false)\n  const { startRouteTransition } = useRouteTransition()\n\n  const restoreMessage = t('version:aboutToRestoreGlobal', {\n    label: getTranslation(label, i18n),\n    versionDate,\n  })\n\n  let fetchURL = `${serverURL}${apiRoute}`\n  let redirectURL: string\n\n  const canRestoreAsDraft = status !== 'draft' && collectionConfig?.versions?.drafts\n\n  if (collectionSlug) {\n    fetchURL = `${fetchURL}/${collectionSlug}/versions/${versionID}?draft=${draft}`\n    redirectURL = formatAdminURL({\n      adminRoute,\n      path: `/collections/${collectionSlug}/${originalDocID}`,\n    })\n  }\n\n  if (globalSlug) {\n    fetchURL = `${fetchURL}/globals/${globalSlug}/versions/${versionID}?draft=${draft}`\n    redirectURL = formatAdminURL({\n      adminRoute,\n      path: `/globals/${globalSlug}`,\n    })\n  }\n\n  const handleRestore = useCallback(async () => {\n    const res = await requests.post(fetchURL, {\n      headers: {\n        'Accept-Language': i18n.language,\n      },\n    })\n\n    if (res.status === 200) {\n      const json = await res.json()\n      toast.success(json.message)\n      return startRouteTransition(() => router.push(redirectURL))\n    } else {\n      toast.error(t('version:problemRestoringVersion'))\n    }\n  }, [fetchURL, redirectURL, t, i18n, router, startRouteTransition])\n\n  return (\n    <Fragment>\n      <div className={[baseClass, className].filter(Boolean).join(' ')}>\n        <Button\n          buttonStyle=\"pill\"\n          className={[canRestoreAsDraft && `${baseClass}__button`].filter(Boolean).join(' ')}\n          onClick={() => toggleModal(modalSlug)}\n          size=\"small\"\n          SubMenuPopupContent={\n            canRestoreAsDraft\n              ? () => (\n                  <PopupList.ButtonGroup>\n                    <PopupList.Button onClick={() => [setDraft(true), toggleModal(modalSlug)]}>\n                      {t('version:restoreAsDraft')}\n                    </PopupList.Button>\n                  </PopupList.ButtonGroup>\n                )\n              : null\n          }\n        >\n          {t('version:restoreThisVersion')}\n        </Button>\n      </div>\n      <ConfirmationModal\n        body={restoreMessage}\n        confirmingLabel={t('version:restoring')}\n        heading={t('version:confirmVersionRestoration')}\n        modalSlug={modalSlug}\n        onConfirm={handleRestore}\n      />\n    </Fragment>\n  )\n}\n\nexport default Restore\n"],"mappings":"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","ignoreList":[]}