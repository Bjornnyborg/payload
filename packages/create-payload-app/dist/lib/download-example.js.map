{"version":3,"sources":["../../src/lib/download-example.ts"],"sourcesContent":["import { Readable } from 'node:stream'\nimport { pipeline } from 'node:stream/promises'\nimport { x } from 'tar'\n\nimport type { ProjectExample } from '../types.js'\n\nimport { debug as debugLog } from '../utils/log.js'\n\nexport async function downloadExample({\n  debug,\n  example,\n  projectDir,\n}: {\n  debug?: boolean\n  example: ProjectExample\n  projectDir: string\n}) {\n  const branchOrTag = example.url.split('#')?.[1] || 'latest'\n  const url = `https://codeload.github.com/payloadcms/payload/tar.gz/${branchOrTag}`\n  const filter = `payload-${branchOrTag.replace(/^v/, '')}/examples/${example.name}/`\n\n  if (debug) {\n    debugLog(`Using example url: ${example.url}`)\n    debugLog(`Codeload url: ${url}`)\n    debugLog(`Filter: ${filter}`)\n  }\n\n  await pipeline(\n    await downloadTarStream(url),\n    x({\n      cwd: projectDir,\n      filter: (p) => p.includes(filter),\n      strip: 2 + example.name.split('/').length,\n    }),\n  )\n}\n\nasync function downloadTarStream(url: string) {\n  const res = await fetch(url)\n\n  if (!res.body) {\n    throw new Error(`Failed to download: ${url}`)\n  }\n\n  return Readable.from(res.body as unknown as NodeJS.ReadableStream)\n}\n"],"names":["Readable","pipeline","x","debug","debugLog","downloadExample","example","projectDir","branchOrTag","url","split","filter","replace","name","downloadTarStream","cwd","p","includes","strip","length","res","fetch","body","Error","from"],"mappings":"AAAA,SAASA,QAAQ,QAAQ,cAAa;AACtC,SAASC,QAAQ,QAAQ,uBAAsB;AAC/C,SAASC,CAAC,QAAQ,MAAK;AAIvB,SAASC,SAASC,QAAQ,QAAQ,kBAAiB;AAEnD,OAAO,eAAeC,gBAAgB,EACpCF,KAAK,EACLG,OAAO,EACPC,UAAU,EAKX;IACC,MAAMC,cAAcF,QAAQG,GAAG,CAACC,KAAK,CAAC,MAAM,CAAC,EAAE,IAAI;IACnD,MAAMD,MAAM,CAAC,sDAAsD,EAAED,aAAa;IAClF,MAAMG,SAAS,CAAC,QAAQ,EAAEH,YAAYI,OAAO,CAAC,MAAM,IAAI,UAAU,EAAEN,QAAQO,IAAI,CAAC,CAAC,CAAC;IAEnF,IAAIV,OAAO;QACTC,SAAS,CAAC,mBAAmB,EAAEE,QAAQG,GAAG,EAAE;QAC5CL,SAAS,CAAC,cAAc,EAAEK,KAAK;QAC/BL,SAAS,CAAC,QAAQ,EAAEO,QAAQ;IAC9B;IAEA,MAAMV,SACJ,MAAMa,kBAAkBL,MACxBP,EAAE;QACAa,KAAKR;QACLI,QAAQ,CAACK,IAAMA,EAAEC,QAAQ,CAACN;QAC1BO,OAAO,IAAIZ,QAAQO,IAAI,CAACH,KAAK,CAAC,KAAKS,MAAM;IAC3C;AAEJ;AAEA,eAAeL,kBAAkBL,GAAW;IAC1C,MAAMW,MAAM,MAAMC,MAAMZ;IAExB,IAAI,CAACW,IAAIE,IAAI,EAAE;QACb,MAAM,IAAIC,MAAM,CAAC,oBAAoB,EAAEd,KAAK;IAC9C;IAEA,OAAOT,SAASwB,IAAI,CAACJ,IAAIE,IAAI;AAC/B"}